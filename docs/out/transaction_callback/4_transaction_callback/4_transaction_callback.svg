<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="721px" preserveAspectRatio="none" style="width:1532px;height:721px;" version="1.1" viewBox="0 0 1532 721" width="1532px" zoomAndPan="magnify"><defs><filter height="300%" id="f1xj55xwryvzqo" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="709.584" style="stroke: #A80036; stroke-width: 1.0;" width="101" x="1" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="38" y="18.5684">PISP</text><rect fill="#DDDDDD" height="709.584" style="stroke: #A80036; stroke-width: 1.0;" width="1052" x="328" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="61" x="823.5" y="18.5684">Mojaloop</text><rect fill="#DDDDDD" height="709.584" style="stroke: #A80036; stroke-width: 1.0;" width="75" x="1382" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="44" x="1397.5" y="18.5684">DFSP B</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="51" y1="77.2871" y2="87.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="51" x2="51" y1="87.2871" y2="141.1973"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="51" y1="141.1973" y2="660.6074"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="419" y1="77.2871" y2="87.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="419" x2="419" y1="87.2871" y2="141.1973"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="419" y1="141.1973" y2="660.6074"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="709.5" x2="709.5" y1="77.2871" y2="87.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="709.5" x2="709.5" y1="87.2871" y2="141.1973"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="709.5" x2="709.5" y1="141.1973" y2="660.6074"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063.5" x2="1063.5" y1="77.2871" y2="87.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1063.5" x2="1063.5" y1="87.2871" y2="141.1973"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063.5" x2="1063.5" y1="141.1973" y2="660.6074"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1316" x2="1316" y1="77.2871" y2="87.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1316" x2="1316" y1="87.2871" y2="141.1973"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1316" x2="1316" y1="141.1973" y2="660.6074"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1419" x2="1419" y1="77.2871" y2="87.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1419" x2="1419" y1="87.2871" y2="141.1973"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1419" x2="1419" y1="141.1973" y2="660.6074"/><rect fill="#FEFECE" filter="url(#f1xj55xwryvzqo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="5" y="41.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="12" y="62.334">PISP Server</text><rect fill="#FEFECE" filter="url(#f1xj55xwryvzqo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="5" y="659.6074"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="12" y="680.1426">PISP Server</text><rect fill="#FEFECE" filter="url(#f1xj55xwryvzqo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="332" y="41.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="339" y="62.334">Thirdparty API Adapter</text><rect fill="#FEFECE" filter="url(#f1xj55xwryvzqo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="332" y="659.6074"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="339" y="680.1426">Thirdparty API Adapter</text><rect fill="#FEFECE" filter="url(#f1xj55xwryvzqo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="176" x="619.5" y="41.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="162" x="626.5" y="62.334">Central Event Processor</text><rect fill="#FEFECE" filter="url(#f1xj55xwryvzqo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="176" x="619.5" y="659.6074"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="162" x="626.5" y="680.1426">Central Event Processor</text><rect fill="#FEFECE" filter="url(#f1xj55xwryvzqo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="1002.5" y="41.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="1009.5" y="62.334">ML API Adapter</text><rect fill="#FEFECE" filter="url(#f1xj55xwryvzqo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="1002.5" y="659.6074"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="1009.5" y="680.1426">ML API Adapter</text><rect fill="#FEFECE" filter="url(#f1xj55xwryvzqo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="1257" y="41.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="1264" y="62.334">Central Ledger</text><rect fill="#FEFECE" filter="url(#f1xj55xwryvzqo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="1257" y="659.6074"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="1264" y="680.1426">Central Ledger</text><rect fill="#FEFECE" filter="url(#f1xj55xwryvzqo)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="1386" y="25.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="1394.5" y="45.8457">DFSP B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="1393" y="62.334">(Payee)</text><rect fill="#FEFECE" filter="url(#f1xj55xwryvzqo)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="1386" y="659.6074"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="1394.5" y="680.1426">DFSP B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="1393" y="696.6309">(Payee)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="640" y="111.9219"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="194" x="640" y="111.9219">Transaction agreement takes place</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="360" x="554" y="124.877">DFSPA intiates transfer, and now waits to hear back from DFSPB</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="917" y="124.877"/><rect fill="#FFFFFF" filter="url(#f1xj55xwryvzqo)" height="99" style="stroke: #A80036; stroke-width: 1.0;" width="208" x="1315" y="146.1973"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="152" x="1319" y="162.2642">PUT /transfers/9876</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="1319" y="177.397">FSPIOP-Source: dfspb</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="1319" y="192.5298">FSPIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1319" y="208.1641">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="1335" y="223.4746">transferState: "COMMITTED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1319" y="238.7852">}</text><polygon fill="#A80036" points="1074.5,267.6602,1064.5,271.6602,1074.5,275.6602,1070.5,271.6602" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1068.5" x2="1418.5" y1="271.6602" y2="271.6602"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="1080.5" y="266.5942">PUT /transfers/9876</text><polygon fill="#A80036" points="1304.5,296.9707,1314.5,300.9707,1304.5,304.9707,1308.5,300.9707" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063.5" x2="1310.5" y1="300.9707" y2="300.9707"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="1070.5" y="296.2285">Transfer accepted by the Payee DFSP</text><polygon fill="#A80036" points="1074.5,326.2813,1064.5,330.2813,1074.5,334.2813,1070.5,330.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1068.5" x2="1315.5" y1="330.2813" y2="330.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="1080.5" y="325.5391">Please notify the DFSPA</text><polygon fill="#A80036" points="720.5,370.9023,710.5,374.9023,720.5,378.9023,716.5,374.9023" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="714.5" x2="1315.5" y1="374.9023" y2="374.9023"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="726.5" y="354.8496">Here's a notification as well, since we're all talking over Kafka.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="726.5" y="370.1602">The transferId is</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="833.5" y="369.8364">9876</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="709.5" x2="751.5" y1="404.2129" y2="404.2129"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="751.5" x2="751.5" y1="404.2129" y2="417.2129"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="710.5" x2="751.5" y1="417.2129" y2="417.2129"/><polygon fill="#A80036" points="720.5,413.2129,710.5,417.2129,720.5,421.2129,716.5,417.2129" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="716.5" y="399.4707">We were waiting for a transfer with a tranferId of</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="1024.5" y="399.147">9876</text><polygon fill="#A80036" points="430.5,442.5234,420.5,446.5234,430.5,450.5234,426.5,446.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424.5" x2="708.5" y1="446.5234" y2="446.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="436.5" y="441.7813">A transfer you subscribed to just occurred</text><rect fill="#FFFFFF" filter="url(#f1xj55xwryvzqo)" height="114" style="stroke: #A80036; stroke-width: 1.0;" width="352" x="243" y="459.5234"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="344" x="247" y="475.5903">PATCH /thirdpartyRequests/transactions/1234</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="247" y="490.7231">FSPIOP-Source: pispa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="247" y="505.856">FSPIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="247" y="521.4902">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="263" y="536.8008">state: "ACCEPTED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="263" y="552.1113">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="247" y="567.4219">}</text><polygon fill="#A80036" points="62.5,596.2969,52.5,600.2969,62.5,604.2969,58.5,600.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="56.5" x2="418.5" y1="600.2969" y2="600.2969"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="344" x="68.5" y="595.231">PATCH /thirdpartyRequests/transactions/1234</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="709.5" x2="751.5" y1="629.6074" y2="629.6074"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="751.5" x2="751.5" y1="629.6074" y2="642.6074"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="710.5" x2="751.5" y1="642.6074" y2="642.6074"/><polygon fill="#A80036" points="720.5,638.6074,710.5,642.6074,720.5,646.6074,716.5,642.6074" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="282" x="716.5" y="624.8652">Stop listening for transfers with transferId of</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="1002.5" y="624.5415">9876</text><!--MD5=[6c50e01ce7089b1150fd95dede8af7b8]
@startuml


box "PISP"
    participant "PISP Server" as D1
end box
box "Mojaloop"
    participant "Thirdparty API Adapter" as 3P
    participant "Central Event Processor" as CEP
    participant "ML API Adapter" as ML
    participant "Central Ledger" as CL
end box

box "DFSP B"
    participant "DFSP B\n(Payee)" as D3
end box

... **Transaction agreement takes place**\n**DFSPA intiates transfer, and now waits to hear back from DFSPB** ...

rnote over D3 #Light
**""PUT /transfers/9876""**
""FSPIOP-Source: dfspb""
""FSPIOP-Destination: dfspa""
{
    transferState: "COMMITTED"
}
end note

D3 -> ML: ""PUT /transfers/9876""

ML -> CL: Transfer accepted by the Payee DFSP

CL -> ML: Please notify the DFSPA
CL -> CEP: Here's a notification as well, since we're all talking over Kafka.\nThe transferId is ""9876""

CEP -> CEP: We were waiting for a transfer with a tranferId of ""9876""
CEP -> 3P: A transfer you subscribed to just occurred

rnote over 3P #Light
**""PATCH /thirdpartyRequests/transactions/1234""**
""FSPIOP-Source: pispa""
""FSPIOP-Destination: dfspa""
{
    state: "ACCEPTED"
    ...
}
end note
3P -> D1: ""PATCH /thirdpartyRequests/transactions/1234""

CEP -> CEP: Stop listening for transfers with transferId of ""9876""

@enduml

PlantUML version 1.2020.18(Thu Oct 01 03:40:44 PHT 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>