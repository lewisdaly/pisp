<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1824px" preserveAspectRatio="none" style="width:1733px;height:1824px;" version="1.1" viewBox="0 0 1733 1824" width="1733px" zoomAndPan="magnify"><defs><filter height="300%" id="f1xztu1p0aknrd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="192" x="767" y="29.4023">PISPTransferSimpleAPI</text><rect fill="#DDDDDD" height="1777.4785" style="stroke: #A80036; stroke-width: 1.0;" width="101" x="1" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="38" y="53.7676">PISP</text><rect fill="#DDDDDD" height="1777.4785" style="stroke: #A80036; stroke-width: 1.0;" width="512" x="104" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="61" x="329.5" y="53.7676">Mojaloop</text><rect fill="#DDDDDD" height="1777.4785" style="stroke: #A80036; stroke-width: 1.0;" width="805" x="843" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="1222.5" y="53.7676">DFSP A</text><rect fill="#DDDDDD" height="1777.4785" style="stroke: #A80036; stroke-width: 1.0;" width="75" x="1650" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="44" x="1665.5" y="53.7676">DFSP B</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="51" y1="112.4863" y2="234.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="51" x2="51" y1="234.2402" y2="275.1953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="51" y1="275.1953" y2="362.5938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="51" x2="51" y1="362.5938" y2="403.5488"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="51" y1="403.5488" y2="1763.7012"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="160" y1="112.4863" y2="234.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="160" x2="160" y1="234.2402" y2="275.1953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="160" y1="275.1953" y2="362.5938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="160" x2="160" y1="362.5938" y2="403.5488"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="160" y1="403.5488" y2="1763.7012"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528" x2="528" y1="112.4863" y2="234.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="528" x2="528" y1="234.2402" y2="275.1953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528" x2="528" y1="275.1953" y2="362.5938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="528" x2="528" y1="362.5938" y2="403.5488"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528" x2="528" y1="403.5488" y2="1763.7012"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="590" x2="590" y1="112.4863" y2="234.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="590" x2="590" y1="234.2402" y2="275.1953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="590" x2="590" y1="275.1953" y2="362.5938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="590" x2="590" y1="362.5938" y2="403.5488"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="590" x2="590" y1="403.5488" y2="1763.7012"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="880" x2="880" y1="112.4863" y2="234.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="880" x2="880" y1="234.2402" y2="275.1953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="880" x2="880" y1="275.1953" y2="362.5938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="880" x2="880" y1="362.5938" y2="403.5488"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="880" x2="880" y1="403.5488" y2="1763.7012"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1302" x2="1302" y1="112.4863" y2="234.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1302" x2="1302" y1="234.2402" y2="275.1953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1302" x2="1302" y1="275.1953" y2="362.5938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1302" x2="1302" y1="362.5938" y2="403.5488"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1302" x2="1302" y1="403.5488" y2="1763.7012"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1397" x2="1397" y1="112.4863" y2="234.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1397" x2="1397" y1="234.2402" y2="275.1953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1397" x2="1397" y1="275.1953" y2="362.5938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1397" x2="1397" y1="362.5938" y2="403.5488"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1397" x2="1397" y1="403.5488" y2="1763.7012"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1495" x2="1495" y1="112.4863" y2="234.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1495" x2="1495" y1="234.2402" y2="275.1953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1495" x2="1495" y1="275.1953" y2="362.5938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1495" x2="1495" y1="362.5938" y2="403.5488"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1495" x2="1495" y1="403.5488" y2="1763.7012"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1596" x2="1596" y1="112.4863" y2="234.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1596" x2="1596" y1="234.2402" y2="275.1953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1596" x2="1596" y1="275.1953" y2="362.5938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1596" x2="1596" y1="362.5938" y2="403.5488"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1596" x2="1596" y1="403.5488" y2="1763.7012"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1687" x2="1687" y1="112.4863" y2="234.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1687" x2="1687" y1="234.2402" y2="275.1953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1687" x2="1687" y1="275.1953" y2="362.5938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1687" x2="1687" y1="362.5938" y2="403.5488"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1687" x2="1687" y1="403.5488" y2="1763.7012"/><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="5" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="12" y="97.5332">PISP Server</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="5" y="1762.7012"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="12" y="1783.2363">PISP Server</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="108" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="115" y="97.5332">auth-service</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="108" y="1762.7012"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="115" y="1783.2363">auth-service</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="497" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="504" y="97.5332">Switch</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="497" y="1762.7012"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="504" y="1783.2363">Switch</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="39" x="569" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="25" x="576" y="97.5332">ALS</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="39" x="569" y="1762.7012"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="25" x="576" y="1783.2363">ALS</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="847" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="854" y="81.0449">DFSP A</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="854.5" y="97.5332">(Payer)</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="847" y="1762.7012"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="854" y="1783.2363">DFSP A</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="854.5" y="1799.7246">(Payer)</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="76" x="1262" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="62" x="1269" y="97.5332">3p-sa-in</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="76" x="1262" y="1762.7012"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="62" x="1269" y="1783.2363">3p-sa-in</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="1352" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="1359" y="97.5332">3p-sa-out</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="1352" y="1762.7012"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="1359" y="1783.2363">3p-sa-out</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="82" x="1452" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="1459" y="97.5332">sdk-sa-in</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="82" x="1452" y="1762.7012"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="1459" y="1783.2363">sdk-sa-in</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1548" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="1555" y="97.5332">sdk-sa-out</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1548" y="1762.7012"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="1555" y="1783.2363">sdk-sa-out</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="1654" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="1662.5" y="81.0449">DFSP B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="1661" y="97.5332">(Payee)</text><rect fill="#FEFECE" filter="url(#f1xztu1p0aknrd)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="1654" y="1762.7012"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="1662.5" y="1783.2363">DFSP B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="1661" y="1799.7246">(Payee)</text><path d="M188,127.4863 L188,152.4863 L863,152.4863 L863,137.4863 L853,127.4863 L188,127.4863 " fill="#FBFB77" filter="url(#f1xztu1p0aknrd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M853,127.4863 L853,137.4863 L863,137.4863 L853,127.4863 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="654" x="194" y="145.0547">This document aims to demonstrate the high level API Calls between the PISP, Mojaloop Hub and DFSPs.</text><rect fill="#EEEEEE" filter="url(#f1xztu1p0aknrd)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1726" x="0" y="182.4521"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="1726" y1="182.4521" y2="182.4521"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="1726" y1="185.4521" y2="185.4521"/><rect fill="#EEEEEE" filter="url(#f1xztu1p0aknrd)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="148" x="789" y="171.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="795" y="188.3652">Discovery (Lookup)</text><polygon fill="#A80036" points="516,222.2402,526,226.2402,516,230.2402,520,226.2402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51.5" x2="522" y1="226.2402" y2="226.2402"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="58.5" y="221.1743">GET /parties/MSISDN/+4412345678</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="239" x="750" y="258.875">Get participants/parties flow not shown here</text><polygon fill="#A80036" points="1675.5,292.3281,1685.5,296.3281,1675.5,300.3281,1679.5,296.3281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528" x2="1681.5" y1="296.3281" y2="296.3281"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="535" y="291.2622">GET /parties/MSISDN/+4412345678</text><polygon fill="#A80036" points="539,321.4609,529,325.4609,539,329.4609,535,325.4609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="533" x2="1686.5" y1="325.4609" y2="325.4609"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="545" y="320.395">PUT /parties/MSISDN/+4412345678</text><polygon fill="#A80036" points="62.5,350.5938,52.5,354.5938,62.5,358.5938,58.5,354.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="56.5" x2="527" y1="354.5938" y2="354.5938"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="68.5" y="349.5278">PUT /parties/MSISDN/+4412345678</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="217" x="761" y="387.2285">PISP confirms payee party with their user</text><rect fill="#EEEEEE" filter="url(#f1xztu1p0aknrd)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1726" x="0" y="424.2041"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="1726" y1="424.2041" y2="424.2041"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="1726" y1="427.2041" y2="427.2041"/><rect fill="#EEEEEE" filter="url(#f1xztu1p0aknrd)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="138" x="794" y="413.5488"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="800" y="430.1172">Agreement Phase</text><polygon fill="#A80036" points="516,463.9922,526,467.9922,516,471.9922,520,467.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51.5" x2="522" y1="467.9922" y2="467.9922"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="58.5" y="462.9263">POST /thirdpartyRequests/transactions</text><polygon fill="#A80036" points="868,493.125,878,497.125,868,501.125,872,497.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528" x2="874" y1="497.125" y2="497.125"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="535" y="492.0591">POST /thirdpartyRequests/transactions</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="880" x2="922" y1="557.0566" y2="557.0566"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="922" x2="922" y1="557.0566" y2="570.0566"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="881" x2="922" y1="570.0566" y2="570.0566"/><polygon fill="#A80036" points="891,566.0566,881,570.0566,891,574.0566,887,570.0566" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="887" y="521.6934">Lookup this</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="966" y="521.3696">consentId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1038" y="521.6934">,</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="1046" y="521.3696">sourceAccountId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1170" y="521.6934"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="887" y="537.0039">and</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="914" y="536.6802">pispId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="962" y="537.0039">. Verify that they exist, and consent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="887" y="552.3145">is granted with a valid credential</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="880" x2="922" y1="599.3672" y2="599.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="922" x2="922" y1="599.3672" y2="612.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="881" x2="922" y1="612.3672" y2="612.3672"/><polygon fill="#A80036" points="891,608.3672,881,612.3672,891,616.3672,887,612.3672" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="380" x="887" y="594.625">Generate a unique transactionId for this transaction request:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="1271" y="594.3013">987</text><polygon fill="#A80036" points="539,637.5,529,641.5,539,645.5,535,641.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="533" x2="879" y1="641.5" y2="641.5"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="545" y="636.4341">PUT /thirdpartyRequests/transactions/{id}</text><polygon fill="#A80036" points="62.5,666.6328,52.5,670.6328,62.5,674.6328,58.5,670.6328" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="56.5" x2="527" y1="670.6328" y2="670.6328"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="68.5" y="665.5669">PUT /thirdpartyRequests/transactions/{id}</text><polygon fill="#A80036" points="539,695.7656,529,699.7656,539,703.7656,535,699.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="533" x2="879" y1="699.7656" y2="699.7656"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="545" y="694.6997">POST /quotes</text><polygon fill="#A80036" points="1675.5,724.8984,1685.5,728.8984,1675.5,732.8984,1679.5,728.8984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528" x2="1681.5" y1="728.8984" y2="728.8984"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="535" y="723.8325">POST /quotes</text><polygon fill="#A80036" points="539,754.0313,529,758.0313,539,762.0313,535,758.0313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="533" x2="1686.5" y1="758.0313" y2="758.0313"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="545" y="752.9653">PUT /quotes/456</text><polygon fill="#A80036" points="868,783.1641,878,787.1641,868,791.1641,872,787.1641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528" x2="874" y1="787.1641" y2="787.1641"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="535" y="782.0981">PUT /quotes/456</text><path d="M603,800.1641 L603,840.1641 L871,840.1641 L871,810.1641 L861,800.1641 L603,800.1641 " fill="#FBFB77" filter="url(#f1xztu1p0aknrd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M861,800.1641 L861,810.1641 L871,810.1641 L861,800.1641 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="609" y="817.7324">DFSPA has the quote, they can now ask</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="609" y="833.043">the PISP for authorization</text><polygon fill="#A80036" points="539,866.918,529,870.918,539,874.918,535,870.918" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="533" x2="879" y1="870.918" y2="870.918"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="545" y="865.8521">POST /authorizations</text><polygon fill="#A80036" points="62.5,896.0508,52.5,900.0508,62.5,904.0508,58.5,900.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="56.5" x2="527" y1="900.0508" y2="900.0508"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="68.5" y="894.9849">POST /authorizations</text><path d="M56,913.0508 L56,953.0508 L409,953.0508 L409,923.0508 L399,913.0508 L56,913.0508 " fill="#FBFB77" filter="url(#f1xztu1p0aknrd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M399,913.0508 L399,923.0508 L409,923.0508 L399,913.0508 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="62" y="930.6191">PISP checks the quote with the user,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="332" x="62" y="945.9297">and uses FIDO to sign the the QuoteResponse object</text><polygon fill="#A80036" points="516,979.8047,526,983.8047,516,987.8047,520,983.8047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51.5" x2="522" y1="983.8047" y2="983.8047"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="58.5" y="978.7388">PUT /authorizations/123</text><polygon fill="#A80036" points="868,1008.9375,878,1012.9375,868,1016.9375,872,1012.9375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528" x2="874" y1="1012.9375" y2="1012.9375"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="535" y="1007.8716">PUT /authorizations/123</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="880" x2="922" y1="1057.5586" y2="1057.5586"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="922" x2="922" y1="1057.5586" y2="1070.5586"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="881" x2="922" y1="1070.5586" y2="1070.5586"/><polygon fill="#A80036" points="891,1066.5586,881,1070.5586,891,1074.5586,887,1070.5586" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="887" y="1037.5059">Lookup the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="962" y="1037.1821">thirdpartyRequests/transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="887" y="1052.8164">request, get the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="990" y="1052.4927">consentId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="1066" y="1052.8164">and</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="1093" y="1052.4927">sourceAccountId</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="880" x2="922" y1="1115.1797" y2="1115.1797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="922" x2="922" y1="1115.1797" y2="1128.1797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="881" x2="922" y1="1128.1797" y2="1128.1797"/><polygon fill="#A80036" points="891,1124.1797,881,1128.1797,891,1132.1797,887,1128.1797" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="887" y="1095.127">Confirm pispId from</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="1019" y="1094.8032">PUT /authorizations/123</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="891" y="1110.4375">matches the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="972" y="1110.1138">thirdpartyRequests/transaction</text><path d="M651,1141.1797 L651,1181.1797 L1105,1181.1797 L1105,1151.1797 L1095,1141.1797 L651,1141.1797 " fill="#FBFB77" filter="url(#f1xztu1p0aknrd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1095,1141.1797 L1095,1151.1797 L1105,1151.1797 L1095,1141.1797 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="657" y="1158.748">Switch has the signed condition</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="433" x="657" y="1174.0586">For 3rd party FIDO, it now needs to make sure everything checks out</text><polygon fill="#A80036" points="539,1223.0664,529,1227.0664,539,1231.0664,535,1227.0664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="533" x2="879" y1="1227.0664" y2="1227.0664"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="545" y="1206.8677">POST /thirdpartyRequests/transactions</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="585" y="1222.0005">/123/authorizations</text><polygon fill="#A80036" points="171,1267.332,161,1271.332,171,1275.332,167,1271.332" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="165" x2="527" y1="1271.332" y2="1271.332"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="177" y="1251.1333">POST /thirdpartyRequests/transactions</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="217" y="1266.2661">/123/authorizations</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="202" y1="1300.6426" y2="1300.6426"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="202" x2="202" y1="1300.6426" y2="1313.6426"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="202" y1="1313.6426" y2="1313.6426"/><polygon fill="#A80036" points="171,1309.6426,161,1313.6426,171,1317.6426,167,1313.6426" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="167" y="1295.9004">Lookup this consent based on consentId</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="202" y1="1342.9531" y2="1342.9531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="202" x2="202" y1="1342.9531" y2="1355.9531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="202" y1="1355.9531" y2="1355.9531"/><polygon fill="#A80036" points="171,1351.9531,161,1355.9531,171,1359.9531,167,1355.9531" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="354" x="167" y="1338.2109">Ensure the sourceAccountId matches what is in Consent</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="202" y1="1400.5742" y2="1400.5742"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="202" x2="202" y1="1400.5742" y2="1413.5742"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="202" y1="1413.5742" y2="1413.5742"/><polygon fill="#A80036" points="171,1409.5742,161,1413.5742,171,1417.5742,167,1413.5742" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="167" y="1380.5215">Check that the signed bytes match the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="167" y="1395.832">publickey we have stored for the consent</text><polygon fill="#A80036" points="516,1453.8398,526,1457.8398,516,1461.8398,520,1457.8398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="522" y1="1457.8398" y2="1457.8398"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="167" y="1437.6411">PUT /thirdpartyRequests/transactions</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="199" y="1452.7739">/123/authorizations</text><polygon fill="#A80036" points="868,1498.1055,878,1502.1055,868,1506.1055,872,1502.1055" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528" x2="874" y1="1502.1055" y2="1502.1055"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="535" y="1481.9067">PUT /thirdpartyRequests/transactions</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="567" y="1497.0396">/123/authorizations</text><path d="M693,1515.1055 L693,1555.1055 L1062,1555.1055 L1062,1525.1055 L1052,1515.1055 L693,1515.1055 " fill="#FBFB77" filter="url(#f1xztu1p0aknrd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1052,1515.1055 L1052,1525.1055 L1062,1525.1055 L1052,1515.1055 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="699" y="1532.6738">DFSPA now knows that the user signed this transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="699" y="1547.9844">and can go ahead and initiate the transfer</text><rect fill="#EEEEEE" filter="url(#f1xztu1p0aknrd)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1726" x="0" y="1585.3818"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="1726" y1="1585.3818" y2="1585.3818"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="1726" y1="1588.3818" y2="1588.3818"/><rect fill="#EEEEEE" filter="url(#f1xztu1p0aknrd)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="120" x="803" y="1574.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="809" y="1591.2949">Transfer Phase</text><polygon fill="#A80036" points="539,1625.1699,529,1629.1699,539,1633.1699,535,1629.1699" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="533" x2="879" y1="1629.1699" y2="1629.1699"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="545" y="1624.104">POST /transfers</text><polygon fill="#A80036" points="1675.5,1654.3027,1685.5,1658.3027,1675.5,1662.3027,1679.5,1658.3027" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528" x2="1681.5" y1="1658.3027" y2="1658.3027"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="535" y="1653.2368">POST /transfers</text><polygon fill="#A80036" points="539,1683.4355,529,1687.4355,539,1691.4355,535,1687.4355" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="533" x2="1686.5" y1="1687.4355" y2="1687.4355"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="545" y="1682.3696">PUT /transfers/321</text><polygon fill="#A80036" points="868,1712.5684,878,1716.5684,868,1720.5684,872,1716.5684" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528" x2="874" y1="1716.5684" y2="1716.5684"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="535" y="1711.5024">PUT /transfers/321</text><polygon fill="#A80036" points="62.5,1741.7012,52.5,1745.7012,62.5,1749.7012,58.5,1745.7012" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="56.5" x2="527" y1="1745.7012" y2="1745.7012"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="336" x="68.5" y="1740.6353">PATCH /thirdpartyRequests/transactions/123</text><!--MD5=[94ad66cc8e31a00b6989dc8db7635b27]
@startuml

title PISPTransferSimpleAPI

!include participants_api.iuml

note over S
This document aims to demonstrate the high level API Calls between the PISP, Mojaloop Hub and DFSPs.
end note


== Discovery (Lookup) ==
D1 -> S: ""GET /parties/MSISDN/+4412345678""
... Get participants/parties flow not shown here ...
S -> D3: ""GET /parties/MSISDN/+4412345678""
D3 -> S: ""PUT /parties/MSISDN/+4412345678""
S -> D1: ""PUT /parties/MSISDN/+4412345678""
... PISP confirms payee party with their user ...

== Agreement Phase ==
D1 -> S: ""POST /thirdpartyRequests/transactions""
S -> D2: ""POST /thirdpartyRequests/transactions""

D2 -> D2: Lookup this ""consentId"", ""sourceAccountId"" \nand ""pispId"". Verify that they exist, and consent \nis granted with a valid credential
D2 -> D2: Generate a unique transactionId for this transaction request: ""987""

D2 -> S: ""PUT /thirdpartyRequests/transactions/{id}""
S -> D1: ""PUT /thirdpartyRequests/transactions/{id}""

D2 -> S: ""POST /quotes""
S -> D3: ""POST /quotes""
D3 -> S: ""PUT /quotes/456""
S -> D2: ""PUT /quotes/456""

note left of D2
  DFSPA has the quote, they can now ask
  the PISP for authorization
end note

D2 -> S: ""POST /authorizations""
S -> D1: ""POST /authorizations""

note right of D1
  PISP checks the quote with the user,
  and uses FIDO to sign the the QuoteResponse object
end note

D1 -> S: ""PUT /authorizations/123""
S -> D2: ""PUT /authorizations/123""

D2 -> D2: Lookup the ""thirdpartyRequests/transaction""\nrequest, get the ""consentId"" and ""sourceAccountId""
D2 -> D2: Confirm pispId from ""PUT /authorizations/123""\n matches the ""thirdpartyRequests/transaction""

note over D2
  Switch has the signed condition
  For 3rd party FIDO, it now needs to make sure everything checks out
end note

D2 -> S: ""POST /thirdpartyRequests/transactions""\n""     /123/authorizations""
S -> AUTHS: ""POST /thirdpartyRequests/transactions""\n""     /123/authorizations""

AUTHS -> AUTHS: Lookup this consent based on consentId
AUTHS -> AUTHS: Ensure the sourceAccountId matches what is in Consent
AUTHS -> AUTHS: Check that the signed bytes match the \npublickey we have stored for the consent

AUTHS -> S: ""PUT /thirdpartyRequests/transactions""\n""    /123/authorizations""
S -> D2: ""PUT /thirdpartyRequests/transactions""\n""    /123/authorizations""

note over D2
  DFSPA now knows that the user signed this transaction
  and can go ahead and initiate the transfer
end note

== Transfer Phase ==

D2 -> S: ""POST /transfers""
S -> D3: ""POST /transfers""
D3 -> S: ""PUT /transfers/321""
S -> D2: ""PUT /transfers/321""
S -> D1: ""PATCH /thirdpartyRequests/transactions/123""

@enduml

@startuml

title PISPTransferSimpleAPI

box "PISP"
participant "PISP Server" as D1
end box
box "Mojaloop"
    participant "auth-service" as AUTHS
    participant Switch as S
    participant "ALS" as A
end box
box "DFSP A"
    participant "DFSP A\n(Payer)" as D2
    participant "3p-sa-in" as D2_3psa_in
    participant "3p-sa-out" as D2_3psa_out
    participant "sdk-sa-in" as D2_sdksa_in
    participant "sdk-sa-out" as D2_sdksa_out
end box
box "DFSP B"
    participant "DFSP B\n(Payee)" as D3
end box

note over S
This document aims to demonstrate the high level API Calls between the PISP, Mojaloop Hub and DFSPs.
end note


== Discovery (Lookup) ==
D1 -> S: ""GET /parties/MSISDN/+4412345678""
... Get participants/parties flow not shown here ...
S -> D3: ""GET /parties/MSISDN/+4412345678""
D3 -> S: ""PUT /parties/MSISDN/+4412345678""
S -> D1: ""PUT /parties/MSISDN/+4412345678""
... PISP confirms payee party with their user ...

== Agreement Phase ==
D1 -> S: ""POST /thirdpartyRequests/transactions""
S -> D2: ""POST /thirdpartyRequests/transactions""

D2 -> D2: Lookup this ""consentId"", ""sourceAccountId"" \nand ""pispId"". Verify that they exist, and consent \nis granted with a valid credential
D2 -> D2: Generate a unique transactionId for this transaction request: ""987""

D2 -> S: ""PUT /thirdpartyRequests/transactions/{id}""
S -> D1: ""PUT /thirdpartyRequests/transactions/{id}""

D2 -> S: ""POST /quotes""
S -> D3: ""POST /quotes""
D3 -> S: ""PUT /quotes/456""
S -> D2: ""PUT /quotes/456""

note left of D2
  DFSPA has the quote, they can now ask
  the PISP for authorization
end note

D2 -> S: ""POST /authorizations""
S -> D1: ""POST /authorizations""

note right of D1
  PISP checks the quote with the user,
  and uses FIDO to sign the the QuoteResponse object
end note

D1 -> S: ""PUT /authorizations/123""
S -> D2: ""PUT /authorizations/123""

D2 -> D2: Lookup the ""thirdpartyRequests/transaction""\nrequest, get the ""consentId"" and ""sourceAccountId""
D2 -> D2: Confirm pispId from ""PUT /authorizations/123""\n matches the ""thirdpartyRequests/transaction""

note over D2
  Switch has the signed condition
  For 3rd party FIDO, it now needs to make sure everything checks out
end note

D2 -> S: ""POST /thirdpartyRequests/transactions""\n""     /123/authorizations""
S -> AUTHS: ""POST /thirdpartyRequests/transactions""\n""     /123/authorizations""

AUTHS -> AUTHS: Lookup this consent based on consentId
AUTHS -> AUTHS: Ensure the sourceAccountId matches what is in Consent
AUTHS -> AUTHS: Check that the signed bytes match the \npublickey we have stored for the consent

AUTHS -> S: ""PUT /thirdpartyRequests/transactions""\n""    /123/authorizations""
S -> D2: ""PUT /thirdpartyRequests/transactions""\n""    /123/authorizations""

note over D2
  DFSPA now knows that the user signed this transaction
  and can go ahead and initiate the transfer
end note

== Transfer Phase ==

D2 -> S: ""POST /transfers""
S -> D3: ""POST /transfers""
D3 -> S: ""PUT /transfers/321""
S -> D2: ""PUT /transfers/321""
S -> D1: ""PATCH /thirdpartyRequests/transactions/123""

@enduml

PlantUML version 1.2020.18(Thu Oct 01 03:40:44 PHT 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>