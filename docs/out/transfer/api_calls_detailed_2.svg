<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="4148px" preserveAspectRatio="none" style="width:1585px;height:4148px;" version="1.1" viewBox="0 0 1585 4148" width="1585px" zoomAndPan="magnify"><defs><filter height="300%" id="f1e2un0sp5qtlc" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="176" x="700" y="23.5352">PISPTransferDetailedAPI</text><rect fill="#DDDDDD" height="4102.5566" style="stroke: #A80036; stroke-width: 1.0;" width="101" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="41" y="47.0566">PISP</text><rect fill="#DDDDDD" height="4102.5566" style="stroke: #A80036; stroke-width: 1.0;" width="308.5" x="363.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="61" x="487.25" y="47.0566">Mojaloop</text><rect fill="#DDDDDD" height="4102.5566" style="stroke: #A80036; stroke-width: 1.0;" width="74" x="940.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="954.5" y="47.0566">DFSP A</text><rect fill="#DDDDDD" height="4102.5566" style="stroke: #A80036; stroke-width: 1.0;" width="75" x="1362" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="44" x="1377.5" y="47.0566">DFSP B</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="54" x2="54" y1="133.4648" y2="4034.0684"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="398.5" x2="398.5" y1="133.4648" y2="4034.0684"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="460.5" x2="460.5" y1="133.4648" y2="4034.0684"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="614" x2="614" y1="133.4648" y2="4034.0684"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="977.5" x2="977.5" y1="133.4648" y2="4034.0684"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1399" x2="1399" y1="133.4648" y2="4034.0684"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1505" x2="1505" y1="133.4648" y2="4034.0684"/><rect fill="#FEFECE" filter="url(#f1e2un0sp5qtlc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="8" y="97.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="15" y="118.5117">PISP Server</text><rect fill="#FEFECE" filter="url(#f1e2un0sp5qtlc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="8" y="4033.0684"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="15" y="4053.6035">PISP Server</text><rect fill="#FEFECE" filter="url(#f1e2un0sp5qtlc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="367.5" y="97.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="374.5" y="118.5117">Switch</text><rect fill="#FEFECE" filter="url(#f1e2un0sp5qtlc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="367.5" y="4033.0684"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="374.5" y="4053.6035">Switch</text><rect fill="#FEFECE" filter="url(#f1e2un0sp5qtlc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="39" x="439.5" y="97.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="25" x="446.5" y="118.5117">ALS</text><rect fill="#FEFECE" filter="url(#f1e2un0sp5qtlc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="39" x="439.5" y="4033.0684"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="25" x="446.5" y="4053.6035">ALS</text><rect fill="#FEFECE" filter="url(#f1e2un0sp5qtlc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="103" x="561" y="97.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="89" x="568" y="118.5117">Auth-Service</text><rect fill="#FEFECE" filter="url(#f1e2un0sp5qtlc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="103" x="561" y="4033.0684"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="89" x="568" y="4053.6035">Auth-Service</text><rect fill="#FEFECE" filter="url(#f1e2un0sp5qtlc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="944.5" y="81.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="951.5" y="102.0234">DFSP A</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="952" y="118.5117">(Payer)</text><rect fill="#FEFECE" filter="url(#f1e2un0sp5qtlc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="944.5" y="4033.0684"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="951.5" y="4053.6035">DFSP A</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="952" y="4070.0918">(Payer)</text><rect fill="#FEFECE" filter="url(#f1e2un0sp5qtlc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="1366" y="81.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="1374.5" y="102.0234">DFSP B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="1373" y="118.5117">(Payee)</text><rect fill="#FEFECE" filter="url(#f1e2un0sp5qtlc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="1366" y="4033.0684"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="1374.5" y="4053.6035">DFSP B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="1373" y="4070.0918">(Payee)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="1474.5" y="114.0234">Bhavesh</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="1443" y="130.5117">(+44 1234 5678)</text><ellipse cx="1505.5" cy="43.4883" fill="#FEFECE" filter="url(#f1e2un0sp5qtlc)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M1505.5,51.4883 L1505.5,78.4883 M1492.5,59.4883 L1518.5,59.4883 M1505.5,78.4883 L1492.5,93.4883 M1505.5,78.4883 L1518.5,93.4883 " fill="none" filter="url(#f1e2un0sp5qtlc)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="1474.5" y="4046.6035">Bhavesh</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="1443" y="4063.0918">(+44 1234 5678)</text><ellipse cx="1505.5" cy="4076.0449" fill="#FEFECE" filter="url(#f1e2un0sp5qtlc)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M1505.5,4084.0449 L1505.5,4111.0449 M1492.5,4092.0449 L1518.5,4092.0449 M1505.5,4111.0449 L1492.5,4126.0449 M1505.5,4111.0449 L1518.5,4126.0449 " fill="none" filter="url(#f1e2un0sp5qtlc)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#EEEEEE" filter="url(#f1e2un0sp5qtlc)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1570" x="3" y="164.1201"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1573" y1="164.1201" y2="164.1201"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1573" y1="167.1201" y2="167.1201"/><rect fill="#EEEEEE" filter="url(#f1e2un0sp5qtlc)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="138" x="719" y="153.4648"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="725" y="170.0332">Agreement Phase</text><rect fill="#FFFFFF" filter="url(#f1e2un0sp5qtlc)" height="451" style="stroke: #A80036; stroke-width: 1.0;" width="324" x="59" y="191.7754"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="296" x="63" y="207.8423">POST /thirdpartyRequests/transactions</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="63" y="222.9751">FSPIOP-Source: pispa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="63" y="238.1079">FSPIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="63" y="253.7422">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="71" y="269.0527">"transactionRequestId": "123",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="71" y="284.3633">"payee": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="79" y="299.6738">"partyIdInfo": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="87" y="314.9844">"partyIdType": "MSISDN",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="87" y="330.2949">"partyIdentifier": "+4412345678",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="87" y="345.6055">"fspId": "dfspb"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="79" y="360.916">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="71" y="376.2266">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="71" y="391.5371">"payer": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="79" y="406.8477">"partyIdType": "THIRD_PARTY_LINK",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="79" y="422.1582">"partyIdentifier": "???",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="79" y="437.4688">"fspId": "dfspa"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="71" y="452.7793">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="71" y="468.0898">"amountType": "SEND",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="71" y="483.4004">"amount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="79" y="498.7109">"amount": "100",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="79" y="514.0215">"currency": "USD"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="71" y="529.332">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="71" y="544.6426">"transactionType": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="79" y="559.9531">"scenario": "TRANSFER",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="79" y="575.2637">"initiator": "PAYER",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="79" y="590.5742">"initiatorType": "CONSUMER"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="71" y="605.8848">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="71" y="621.1953">"expiration": "2020-06-15T22:17:28.985-01:00"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="63" y="636.5059">}</text><polygon fill="#A80036" points="386.5,665.3809,396.5,669.3809,386.5,673.3809,390.5,669.3809" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="54.5" x2="392.5" y1="669.3809" y2="669.3809"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="61.5" y="664.3149">POST /thirdpartyRequests/transactions</text><polygon fill="#A80036" points="65.5,694.5137,55.5,698.5137,65.5,702.5137,61.5,698.5137" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="59.5" x2="397.5" y1="698.5137" y2="698.5137"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="71.5" y="693.4478">202 Accepted</text><polygon fill="#A80036" points="965.5,723.6465,975.5,727.6465,965.5,731.6465,969.5,727.6465" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="398.5" x2="971.5" y1="727.6465" y2="727.6465"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="405.5" y="722.5806">POST /thirdpartyRequests/transactions</text><polygon fill="#A80036" points="409.5,752.7793,399.5,756.7793,409.5,760.7793,405.5,756.7793" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="403.5" x2="976.5" y1="756.7793" y2="756.7793"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="415.5" y="751.7134">202 Accepted</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="977.5" x2="1019.5" y1="801.4004" y2="801.4004"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1019.5" x2="1019.5" y1="801.4004" y2="814.4004"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="978.5" x2="1019.5" y1="814.4004" y2="814.4004"/><polygon fill="#A80036" points="988.5,810.4004,978.5,814.4004,988.5,818.4004,984.5,814.4004" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="984.5" y="781.3477">Lookup this</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="1063.5" y="781.0239">payer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1103.5" y="781.3477">, verify that they exist, and consent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="984.5" y="796.6582">is granted with a valid credential</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="977.5" x2="1019.5" y1="843.7109" y2="843.7109"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1019.5" x2="1019.5" y1="843.7109" y2="856.7109"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="978.5" x2="1019.5" y1="856.7109" y2="856.7109"/><polygon fill="#A80036" points="988.5,852.7109,978.5,856.7109,988.5,860.7109,984.5,856.7109" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="380" x="984.5" y="838.9688">Generate a unique transactionId for this transaction request:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="1368.5" y="838.645">987</text><rect fill="#FFFFFF" filter="url(#f1e2un0sp5qtlc)" height="114" style="stroke: #A80036; stroke-width: 1.0;" width="328" x="644" y="869.7109"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="320" x="648" y="885.7778">PUT /thirdpartyRequests/transactions/123</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="648" y="900.9106">FSPIOP-Source: dfspa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="648" y="916.0435">FSPIOP-Destination: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="648" y="931.6777">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="656" y="946.9883">"transactionId": "987",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="656" y="962.2988">"transactionRequestState": "RECEIVED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="648" y="977.6094">}</text><polygon fill="#A80036" points="409.5,1006.4844,399.5,1010.4844,409.5,1014.4844,405.5,1010.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403.5" x2="976.5" y1="1010.4844" y2="1010.4844"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="415.5" y="1005.4185">PUT /thirdpartyRequests/transactions/123</text><polygon fill="#A80036" points="965.5,1035.6172,975.5,1039.6172,965.5,1043.6172,969.5,1039.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="398.5" x2="971.5" y1="1039.6172" y2="1039.6172"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="405.5" y="1034.5513">200 OK</text><polygon fill="#A80036" points="65.5,1064.75,55.5,1068.75,65.5,1072.75,61.5,1068.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59.5" x2="397.5" y1="1068.75" y2="1068.75"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="71.5" y="1063.6841">PUT /thirdpartyRequests/transactions/123</text><polygon fill="#A80036" points="386.5,1093.8828,396.5,1097.8828,386.5,1101.8828,390.5,1097.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="54.5" x2="392.5" y1="1097.8828" y2="1097.8828"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="61.5" y="1092.8169">200 OK</text><rect fill="#FFFFFF" filter="url(#f1e2un0sp5qtlc)" height="619" style="stroke: #A80036; stroke-width: 1.0;" width="493" x="479" y="1110.8828"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="96" x="483" y="1126.9497">POST /quotes</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="483" y="1142.0825">FSPIOP-Source: dfspa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="483" y="1157.2153">FSPIOP-Destination: dfspb</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="483" y="1172.8496">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="491" y="1188.1602">"quoteId": "456", //Set by the payer dfsp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="289" x="491" y="1203.4707">"transactionId": "987", //Set by the payer dfsp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="477" x="491" y="1218.7813">*"transactionRequestId": "123", //Relates to the original thirdpartyRequest!*</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="491" y="1234.0918">"payee": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="499" y="1249.4023">"partyIdInfo": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="507" y="1264.7129">"partyIdType": "MSISDN",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="507" y="1280.0234">"partyIdentifier": "+4412345678",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="507" y="1295.334">"fspId": "dfspb"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="499" y="1310.6445">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="491" y="1325.9551">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="491" y="1341.2656">"payer": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="499" y="1356.5762">"personalInfo": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="507" y="1371.8867">"complexName": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="515" y="1387.1973">"firstName": "Ayesha",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="515" y="1402.5078">"lastName": "Takia"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="507" y="1417.8184">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="499" y="1433.1289">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="499" y="1448.4395">"partyIdInfo": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="507" y="1463.75">"partyIdType": "THIRD_PARTY_LINK",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="507" y="1479.0605">"partyIdentifier": "???",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="507" y="1494.3711">"fspId": "dfspa"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="499" y="1509.6816">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="499" y="1524.9922">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="491" y="1540.3027">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="491" y="1555.6133">"amountType": "SEND",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="491" y="1570.9238">"amount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="499" y="1586.2344">"amount": "100",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="499" y="1601.5449">"currency": "USD"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="491" y="1616.8555">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="491" y="1632.166">"transactionType": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="499" y="1647.4766">"scenario": "TRANSFER",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="499" y="1662.7871">"initiator": "PAYER",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="499" y="1678.0977">"initiatorType": "CONSUMER"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="491" y="1693.4082">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="491" y="1708.7188">"note": "quote note"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="483" y="1724.0293">}</text><polygon fill="#A80036" points="409.5,1752.9043,399.5,1756.9043,409.5,1760.9043,405.5,1756.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403.5" x2="976.5" y1="1756.9043" y2="1756.9043"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="415.5" y="1751.8384">POST /quotes</text><polygon fill="#A80036" points="965.5,1782.0371,975.5,1786.0371,965.5,1790.0371,969.5,1786.0371" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="398.5" x2="971.5" y1="1786.0371" y2="1786.0371"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="405.5" y="1780.9712">202 Accepted</text><polygon fill="#A80036" points="1387.5,1811.1699,1397.5,1815.1699,1387.5,1819.1699,1391.5,1815.1699" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="398.5" x2="1393.5" y1="1815.1699" y2="1815.1699"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="405.5" y="1810.104">POST /quotes</text><polygon fill="#A80036" points="409.5,1840.3027,399.5,1844.3027,409.5,1848.3027,405.5,1844.3027" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="403.5" x2="1398.5" y1="1844.3027" y2="1844.3027"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="415.5" y="1839.2368">202 Accepted</text><rect fill="#FFFFFF" filter="url(#f1e2un0sp5qtlc)" height="313" style="stroke: #A80036; stroke-width: 1.0;" width="284" x="688" y="1857.3027"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="692" y="1873.3696">PUT /quotes/456</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="692" y="1888.5024">FSPIOP-Source: dfspb</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="692" y="1903.6353">FSPIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="692" y="1919.2695">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="700" y="1934.5801">"transferAmount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="708" y="1949.8906">"amount": "100",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="708" y="1965.2012">"currency": "USD"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="700" y="1980.5117">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="700" y="1995.8223">"payeeReceiveAmount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="708" y="2011.1328">"amount": "99",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="708" y="2026.4434">"currency": "USD"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="700" y="2041.7539">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="700" y="2057.0645">"payeeFspFee": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="708" y="2072.375">"amount": "1",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="708" y="2087.6855">"currency": "USD"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="700" y="2102.9961">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="700" y="2118.3066">"expiration": "2020-06-15T12:00:00.000",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="700" y="2133.6172">"ilpPacket": "...",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="700" y="2148.9277">"condition": "...",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="692" y="2164.2383">}</text><polygon fill="#A80036" points="409.5,2193.1133,399.5,2197.1133,409.5,2201.1133,405.5,2197.1133" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403.5" x2="1398.5" y1="2197.1133" y2="2197.1133"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="415.5" y="2192.0474">PUT /quotes/456</text><polygon fill="#A80036" points="1387.5,2222.2461,1397.5,2226.2461,1387.5,2230.2461,1391.5,2226.2461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="398.5" x2="1393.5" y1="2226.2461" y2="2226.2461"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="405.5" y="2221.1802">200 OK</text><polygon fill="#A80036" points="965.5,2251.3789,975.5,2255.3789,965.5,2259.3789,969.5,2255.3789" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="398.5" x2="971.5" y1="2255.3789" y2="2255.3789"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="405.5" y="2250.313">PUT /quotes/456</text><polygon fill="#A80036" points="409.5,2280.5117,399.5,2284.5117,409.5,2288.5117,405.5,2284.5117" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="403.5" x2="976.5" y1="2284.5117" y2="2284.5117"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="415.5" y="2279.4458">200 OK</text><path d="M700,2297.5117 L700,2337.5117 L968,2337.5117 L968,2307.5117 L958,2297.5117 L700,2297.5117 " fill="#FBFB77" filter="url(#f1e2un0sp5qtlc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M958,2297.5117 L958,2307.5117 L968,2307.5117 L958,2297.5117 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="706" y="2315.0801">DFSPA has the quote, they can now ask</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="706" y="2330.3906">the PISP for authorization</text><rect fill="#FFFFFF" filter="url(#f1e2un0sp5qtlc)" height="267" style="stroke: #A80036; stroke-width: 1.0;" width="488" x="484" y="2352.1328"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="160" x="488" y="2368.1997">POST /authorizations</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="488" y="2383.3325">FSPIOP-Source: dfspa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="488" y="2398.4653">FSPIOP-Destination: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="488" y="2414.0996">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="496" y="2429.4102">"authorizationId": "999",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="496" y="2444.7207">"authenticationType": TODO,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="492" y="2460.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="271" x="496" y="2475.3418">//transactionRequestId is our 'primary key'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="496" y="2490.6523">//to refer to this authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="496" y="2505.9629"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="205" x="496" y="2505.9629">"transactionRequestId": "123",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="496" y="2521.2734">"authenticationType": "U2F",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="496" y="2536.584">"retriesLeft": "1",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="496" y="2551.8945">"transaction": "TODO",...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="496" y="2567.2051">"condition": "...",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="472" x="496" y="2582.5156">// SHA_256(canonicalJson(transaction)), but provided here for convenience</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="496" y="2597.8262">"challenge": "...",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="488" y="2613.1367">}</text><polygon fill="#A80036" points="409.5,2642.0117,399.5,2646.0117,409.5,2650.0117,405.5,2646.0117" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403.5" x2="976.5" y1="2646.0117" y2="2646.0117"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="415.5" y="2640.9458">POST /authorizations</text><polygon fill="#A80036" points="965.5,2671.1445,975.5,2675.1445,965.5,2679.1445,969.5,2675.1445" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="398.5" x2="971.5" y1="2675.1445" y2="2675.1445"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="405.5" y="2670.0786">202 Accepted</text><polygon fill="#A80036" points="65.5,2700.2773,55.5,2704.2773,65.5,2708.2773,61.5,2704.2773" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59.5" x2="397.5" y1="2704.2773" y2="2704.2773"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="71.5" y="2699.2114">POST /authorizations</text><polygon fill="#A80036" points="386.5,2729.4102,396.5,2733.4102,386.5,2737.4102,390.5,2733.4102" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="54.5" x2="392.5" y1="2733.4102" y2="2733.4102"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="61.5" y="2728.3442">202 Accepted</text><path d="M59,2746.4102 L59,2786.4102 L412,2786.4102 L412,2756.4102 L402,2746.4102 L59,2746.4102 " fill="#FBFB77" filter="url(#f1e2un0sp5qtlc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M402,2746.4102 L402,2756.4102 L412,2756.4102 L402,2746.4102 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="65" y="2763.9785">PISP checks the quote with the user,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="332" x="65" y="2779.2891">and uses FIDO to sign the the QuoteResponse object</text><rect fill="#FFFFFF" filter="url(#f1e2un0sp5qtlc)" height="206" style="stroke: #A80036; stroke-width: 1.0;" width="429" x="59" y="2801.0313"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="184" x="63" y="2817.0981">PUT /authorizations/999</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="63" y="2832.231">FSPIOP-Source: pispa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="63" y="2847.3638">FSPIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="63" y="2862.998">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="71" y="2878.3086">"authenticationInfo": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="79" y="2893.6191">"authentication": "U2F",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="79" y="2908.9297">"authenticationValue": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="397" x="87" y="2924.2402">"pinValue": "&lt;base64 encoded binary - the signed challenge&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="87" y="2939.5508">"counter": "1"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="79" y="2954.8613">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="71" y="2970.1719">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="71" y="2985.4824">"responseType": "ENTERED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="63" y="3000.793">}</text><polygon fill="#A80036" points="386.5,3029.668,396.5,3033.668,386.5,3037.668,390.5,3033.668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="54.5" x2="392.5" y1="3033.668" y2="3033.668"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="61.5" y="3028.6021">PUT /authorizations/999</text><polygon fill="#A80036" points="65.5,3058.8008,55.5,3062.8008,65.5,3066.8008,61.5,3062.8008" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="59.5" x2="397.5" y1="3062.8008" y2="3062.8008"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="71.5" y="3057.7349">200 OK</text><polygon fill="#A80036" points="965.5,3087.9336,975.5,3091.9336,965.5,3095.9336,969.5,3091.9336" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="398.5" x2="971.5" y1="3091.9336" y2="3091.9336"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="405.5" y="3086.8677">PUT /authorizations/999</text><polygon fill="#A80036" points="409.5,3117.0664,399.5,3121.0664,409.5,3125.0664,405.5,3121.0664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="403.5" x2="976.5" y1="3121.0664" y2="3121.0664"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="415.5" y="3116.0005">200 OK</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="977.5" x2="1019.5" y1="3165.6875" y2="3165.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1019.5" x2="1019.5" y1="3165.6875" y2="3178.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="978.5" x2="1019.5" y1="3178.6875" y2="3178.6875"/><polygon fill="#A80036" points="988.5,3174.6875,978.5,3178.6875,988.5,3182.6875,984.5,3178.6875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="984.5" y="3145.6348">Lookup the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="1059.5" y="3145.311">thirdpartyRequests/transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="984.5" y="3160.9453">request, get the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1087.5" y="3160.6216">consentId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="1163.5" y="3160.9453">and</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="1190.5" y="3160.6216">sourceAccountId</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="977.5" x2="1019.5" y1="3223.3086" y2="3223.3086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1019.5" x2="1019.5" y1="3223.3086" y2="3236.3086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="978.5" x2="1019.5" y1="3236.3086" y2="3236.3086"/><polygon fill="#A80036" points="988.5,3232.3086,978.5,3236.3086,988.5,3240.3086,984.5,3236.3086" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="984.5" y="3203.2559">Confirm pispId from</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="1116.5" y="3202.9321">PUT /authorizations/123</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="988.5" y="3218.5664">matches the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="1069.5" y="3218.2427">thirdpartyRequests/transaction</text><path d="M748,3249.3086 L748,3289.3086 L1202,3289.3086 L1202,3259.3086 L1192,3249.3086 L748,3249.3086 " fill="#FBFB77" filter="url(#f1e2un0sp5qtlc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1192,3249.3086 L1192,3259.3086 L1202,3259.3086 L1192,3249.3086 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="754" y="3266.877">DFSP has the signed condition</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="433" x="754" y="3282.1875">For 3rd party FIDO, it now needs to make sure everything checks out</text><rect fill="#FFFFFF" filter="url(#f1e2un0sp5qtlc)" height="175" style="stroke: #A80036; stroke-width: 1.0;" width="264" x="708" y="3303.9297"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="168" x="712" y="3319.9966">POST /authentications</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="712" y="3335.1294">FSPIOP-Source: dfspa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="712" y="3350.2622">FSPIOP-Destination: central-auth</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="712" y="3365.8965">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="720" y="3381.207">"authenticationRequestId": "888",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="720" y="3396.5176">"consentId": todo,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="720" y="3411.8281">"accountAddress": todo,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="720" y="3427.1387">"challenge: "...",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="720" y="3442.4492">//signed challenge by PISP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="720" y="3457.7598">"response": "..."</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="712" y="3473.0703">}</text><polygon fill="#A80036" points="409.5,3501.9453,399.5,3505.9453,409.5,3509.9453,405.5,3505.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403.5" x2="976.5" y1="3505.9453" y2="3505.9453"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="415.5" y="3500.8794">POST /authentications</text><polygon fill="#A80036" points="965.5,3531.0781,975.5,3535.0781,965.5,3539.0781,969.5,3535.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="398.5" x2="971.5" y1="3535.0781" y2="3535.0781"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="405.5" y="3530.0122">202 Accepted</text><polygon fill="#A80036" points="602.5,3560.2109,612.5,3564.2109,602.5,3568.2109,606.5,3564.2109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="398.5" x2="608.5" y1="3564.2109" y2="3564.2109"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="405.5" y="3559.145">POST /authentications</text><polygon fill="#A80036" points="409.5,3589.3438,399.5,3593.3438,409.5,3597.3438,405.5,3593.3438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="403.5" x2="613.5" y1="3593.3438" y2="3593.3438"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="415.5" y="3588.2778">202 Accepted</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="614.5" x2="656.5" y1="3622.6543" y2="3622.6543"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="656.5" x2="656.5" y1="3622.6543" y2="3635.6543"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="615.5" x2="656.5" y1="3635.6543" y2="3635.6543"/><polygon fill="#A80036" points="625.5,3631.6543,615.5,3635.6543,625.5,3639.6543,621.5,3635.6543" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="621.5" y="3617.9121">Lookup this consent based on consentId</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="614.5" x2="656.5" y1="3664.9648" y2="3664.9648"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="656.5" x2="656.5" y1="3664.9648" y2="3677.9648"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="615.5" x2="656.5" y1="3677.9648" y2="3677.9648"/><polygon fill="#A80036" points="625.5,3673.9648,615.5,3677.9648,625.5,3681.9648,621.5,3677.9648" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="349" x="621.5" y="3660.2227">Ensure the accountAddress matches what is in Consent</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="614.5" x2="656.5" y1="3722.5859" y2="3722.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="656.5" x2="656.5" y1="3722.5859" y2="3735.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="615.5" x2="656.5" y1="3735.5859" y2="3735.5859"/><polygon fill="#A80036" points="625.5,3731.5859,615.5,3735.5859,625.5,3739.5859,621.5,3735.5859" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="621.5" y="3702.5332">Check that the signed bytes match the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="621.5" y="3717.8438">publickey we have stored for the consent</text><rect fill="#FFFFFF" filter="url(#f1e2un0sp5qtlc)" height="99" style="stroke: #A80036; stroke-width: 1.0;" width="250" x="619" y="3748.5859"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="192" x="623" y="3764.6528">PUT /authentications/888</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="623" y="3779.7856">FSPIOP-Source: central-auth</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="623" y="3794.9185">FSPIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="623" y="3810.5527">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="631" y="3825.8633">"authenticationResponse": "VERIFIED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="623" y="3841.1738">}</text><polygon fill="#A80036" points="409.5,3870.0488,399.5,3874.0488,409.5,3878.0488,405.5,3874.0488" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403.5" x2="613.5" y1="3874.0488" y2="3874.0488"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="415.5" y="3868.9829">PUT /authentications/888</text><polygon fill="#A80036" points="602.5,3899.1816,612.5,3903.1816,602.5,3907.1816,606.5,3903.1816" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="398.5" x2="608.5" y1="3903.1816" y2="3903.1816"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="405.5" y="3898.1157">200 OK</text><polygon fill="#A80036" points="965.5,3928.3145,975.5,3932.3145,965.5,3936.3145,969.5,3932.3145" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="398.5" x2="971.5" y1="3932.3145" y2="3932.3145"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="405.5" y="3927.2485">PUT /authentications/888</text><polygon fill="#A80036" points="409.5,3957.4473,399.5,3961.4473,409.5,3965.4473,405.5,3961.4473" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="403.5" x2="976.5" y1="3961.4473" y2="3961.4473"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="415.5" y="3956.3813">200 OK</text><path d="M791,3974.4473 L791,4014.4473 L1160,4014.4473 L1160,3984.4473 L1150,3974.4473 L791,3974.4473 " fill="#FBFB77" filter="url(#f1e2un0sp5qtlc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1150,3974.4473 L1150,3984.4473 L1160,3984.4473 L1150,3974.4473 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="797" y="3992.0156">DFSPA now knows that the user signed this transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="797" y="4007.3262">and can go ahead and initiate the transfer</text><!--
@startuml

title PISPTransferDetailedAPI

box "PISP"
participant "PISP Server" as D1
end box
box "Mojaloop"
    participant Switch as S
    participant "ALS" as A
    participant "Auth-Service" as AUTHS
end box
box "DFSP A"
    participant "DFSP A\n(Payer)" as D2
end box
box "DFSP B"
    participant "DFSP B\n(Payee)" as D3
end box
actor "Bhavesh\n(+44 1234 5678)" as CB

== Agreement Phase ==
rnote right of D1 #Light
**""POST /thirdpartyRequests/transactions""**
""FSPIOP-Source: pispa""
""FSPIOP-Destination: dfspa""
{
  "transactionRequestId": "123",
  "payee": {
    "partyIdInfo": {
      "partyIdType": "MSISDN",
      "partyIdentifier": "+4412345678",
      "fspId": "dfspb"
    }
  },
  "payer": {
    "partyIdType": "THIRD_PARTY_LINK",
    "partyIdentifier": "???",
    "fspId": "dfspa"
  },
  "amountType": "SEND",
  "amount": {
    "amount": "100",
    "currency": "USD"
  },
  "transactionType": {
    "scenario": "TRANSFER",
    "initiator": "PAYER",
    "initiatorType": "CONSUMER"
  },
  "expiration": "2020-06-15T22:17:28.985-01:00"
}
end note
D1 -> S: ""POST /thirdpartyRequests/transactions""
S - -> D1: ""202 Accepted""
S -> D2: ""POST /thirdpartyRequests/transactions""
D2 - -> S: ""202 Accepted""
D2 -> D2: Lookup this ""payer"", verify that they exist, and consent \nis granted with a valid credential
D2 -> D2: Generate a unique transactionId for this transaction request: ""987""


rnote left of D2 #Light
**""PUT /thirdpartyRequests/transactions/123""**
""FSPIOP-Source: dfspa""
""FSPIOP-Destination: pispa""
{
  "transactionId": "987",
  "transactionRequestState": "RECEIVED"
}
end note
D2 -> S: ""PUT /thirdpartyRequests/transactions/123""
S - -> D2: ""200 OK""
S -> D1: ""PUT /thirdpartyRequests/transactions/123""
D1 - -> S: ""200 OK""


rnote left of D2 #Light
**""POST /quotes""**
""FSPIOP-Source: dfspa""
""FSPIOP-Destination: dfspb""
{
  "quoteId": "456", //Set by the payer dfsp
  "transactionId": "987", //Set by the payer dfsp
  *"transactionRequestId": "123", //Relates to the original thirdpartyRequest!*
  "payee": {
    "partyIdInfo": {
      "partyIdType": "MSISDN",
      "partyIdentifier": "+4412345678",
      "fspId": "dfspb"
    }
  },
  "payer": {
    "personalInfo": {
      "complexName": {
        "firstName": "Ayesha",
        "lastName": "Takia"
      }
    },
    "partyIdInfo": {
      "partyIdType": "THIRD_PARTY_LINK",
      "partyIdentifier": "???",
      "fspId": "dfspa"
    },
    },
  },
  "amountType": "SEND",
  "amount": {
    "amount": "100",
    "currency": "USD"
  },
  "transactionType": {
    "scenario": "TRANSFER",
    "initiator": "PAYER",
    "initiatorType": "CONSUMER"
  },
  "note": "quote note"
}
end note
D2 -> S: ""POST /quotes""
S - -> D2: ""202 Accepted""
S -> D3: ""POST /quotes""
D3 - -> S: ""202 Accepted""

rnote left of D2 #Light
**""PUT /quotes/456""**
""FSPIOP-Source: dfspb""
""FSPIOP-Destination: dfspa""
{
  "transferAmount": {
    "amount": "100",
    "currency": "USD"
  },
  "payeeReceiveAmount": {
    "amount": "99",
    "currency": "USD"
  },
  "payeeFspFee": {
    "amount": "1",
    "currency": "USD"
  },
  "expiration": "2020-06-15T12:00:00.000",
  "ilpPacket": "...",
  "condition": "...",
}
end note
D3 -> S: ""PUT /quotes/456""
S - -> D3: ""200 OK""
S -> D2: ""PUT /quotes/456""
D2 - -> S: ""200 OK""

note left of D2
  DFSPA has the quote, they can now ask
  the PISP for authorization
end note

rnote left of D2 #Light
**""POST /authorizations""**
""FSPIOP-Source: dfspa""
""FSPIOP-Destination: pispa""
{
  "authorizationId": "999",
  "authenticationType": TODO,

  //transactionRequestId is our 'primary key'
  //to refer to this authorization
  **"transactionRequestId": "123",**
  "authenticationType": "U2F",
  "retriesLeft": "1",
  "transaction": "TODO",...
  "condition": "...",
  // SHA_256(canonicalJson(transaction)), but provided here for convenience
  "challenge": "...",
}
end note
D2 -> S: ""POST /authorizations""
S - -> D2: ""202 Accepted""
S -> D1: ""POST /authorizations""
D1 - -> S: ""202 Accepted""

note right of D1
  PISP checks the quote with the user,
  and uses FIDO to sign the the QuoteResponse object
end note

rnote right of D1 #Light
**""PUT /authorizations/999""**
""FSPIOP-Source: pispa""
""FSPIOP-Destination: dfspa""
{
  "authenticationInfo": {
    "authentication": "U2F",
    "authenticationValue": {
      "pinValue": "<base64 encoded binary - the signed challenge>",
      "counter": "1"
    }
  }
  "responseType": "ENTERED"
}
end note
D1 -> S: ""PUT /authorizations/999""
S - -> D1: ""200 OK""
S -> D2: ""PUT /authorizations/999""
D2 - -> S: ""200 OK""

D2 -> D2: Lookup the ""thirdpartyRequests/transaction""\nrequest, get the ""consentId"" and ""sourceAccountId""
D2 -> D2: Confirm pispId from ""PUT /authorizations/123""\n matches the ""thirdpartyRequests/transaction""

note over D2
  DFSP has the signed condition
  For 3rd party FIDO, it now needs to make sure everything checks out
end note

rnote left of D2 #Light
**""POST /authentications""**
""FSPIOP-Source: dfspa""
""FSPIOP-Destination: central-auth""
{
  "authenticationRequestId": "888",
  "consentId": todo,
  "accountAddress": todo,
  "challenge: "...",
  //signed challenge by PISP
  "response": "..."
}
end note
D2 -> S: ""POST /authentications""
S - -> D2: ""202 Accepted""
S -> AUTHS: ""POST /authentications""
AUTHS - -> S: ""202 Accepted""

AUTHS -> AUTHS: Lookup this consent based on consentId
AUTHS -> AUTHS: Ensure the accountAddress matches what is in Consent
AUTHS -> AUTHS: Check that the signed bytes match the \npublickey we have stored for the consent

rnote right of AUTHS #Light
**""PUT /authentications/888""**
""FSPIOP-Source: central-auth""
""FSPIOP-Destination: dfspa""
{
  "authenticationResponse": "VERIFIED"
}
end note
AUTHS -> S: ""PUT /authentications/888""
S - -> AUTHS: ""200 OK""
S -> D2: ""PUT /authentications/888""
D2 - -> S: ""200 OK""

note over D2
  DFSPA now knows that the user signed this transaction
  and can go ahead and initiate the transfer
end note



@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 PHT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_171-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>