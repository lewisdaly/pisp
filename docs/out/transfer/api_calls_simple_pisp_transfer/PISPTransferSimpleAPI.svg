<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2113px" preserveAspectRatio="none" style="width:2427px;height:2113px;" version="1.1" viewBox="0 0 2427 2113" width="2427px" zoomAndPan="magnify"><defs><filter height="300%" id="f17mirdyyahe60" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="192" x="1114.25" y="29.4023">PISPTransferSimpleAPI</text><rect fill="#DDDDDD" height="2066.207" style="stroke: #A80036; stroke-width: 1.0;" width="101" x="84" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="121" y="53.7676">PISP</text><rect fill="#DDDDDD" height="2066.207" style="stroke: #A80036; stroke-width: 1.0;" width="512" x="187" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="61" x="412.5" y="53.7676">Mojaloop</text><rect fill="#DDDDDD" height="2066.207" style="stroke: #A80036; stroke-width: 1.0;" width="1227" x="701" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="1291.5" y="53.7676">DFSP A</text><rect fill="#DDDDDD" height="2066.207" style="stroke: #A80036; stroke-width: 1.0;" width="75" x="2344.5" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="44" x="2360" y="53.7676">DFSP B</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="134" x2="134" y1="112.4863" y2="273.5508"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="134" x2="134" y1="273.5508" y2="314.5059"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="134" x2="134" y1="314.5059" y2="401.9043"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="134" x2="134" y1="401.9043" y2="442.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="134" x2="134" y1="442.8594" y2="2052.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="243" y1="112.4863" y2="273.5508"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="243" x2="243" y1="273.5508" y2="314.5059"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="243" y1="314.5059" y2="401.9043"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="243" x2="243" y1="401.9043" y2="442.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="243" y1="442.8594" y2="2052.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="611" x2="611" y1="112.4863" y2="273.5508"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="611" x2="611" y1="273.5508" y2="314.5059"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="611" x2="611" y1="314.5059" y2="401.9043"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="611" x2="611" y1="401.9043" y2="442.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="611" x2="611" y1="442.8594" y2="2052.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="673" x2="673" y1="112.4863" y2="273.5508"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="673" x2="673" y1="273.5508" y2="314.5059"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="673" x2="673" y1="314.5059" y2="401.9043"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="673" x2="673" y1="401.9043" y2="442.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="673" x2="673" y1="442.8594" y2="2052.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="738" x2="738" y1="112.4863" y2="273.5508"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="738" x2="738" y1="273.5508" y2="314.5059"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="738" x2="738" y1="314.5059" y2="401.9043"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="738" x2="738" y1="401.9043" y2="442.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="738" x2="738" y1="442.8594" y2="2052.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="931" x2="931" y1="112.4863" y2="273.5508"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="931" x2="931" y1="273.5508" y2="314.5059"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="931" x2="931" y1="314.5059" y2="401.9043"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="931" x2="931" y1="401.9043" y2="442.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="931" x2="931" y1="442.8594" y2="2052.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1248" x2="1248" y1="112.4863" y2="273.5508"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1248" x2="1248" y1="273.5508" y2="314.5059"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1248" x2="1248" y1="314.5059" y2="401.9043"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1248" x2="1248" y1="401.9043" y2="442.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1248" x2="1248" y1="442.8594" y2="2052.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1536" x2="1536" y1="112.4863" y2="273.5508"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1536" x2="1536" y1="273.5508" y2="314.5059"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1536" x2="1536" y1="314.5059" y2="401.9043"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1536" x2="1536" y1="401.9043" y2="442.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1536" x2="1536" y1="442.8594" y2="2052.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1876" x2="1876" y1="112.4863" y2="273.5508"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1876" x2="1876" y1="273.5508" y2="314.5059"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1876" x2="1876" y1="314.5059" y2="401.9043"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1876" x2="1876" y1="401.9043" y2="442.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1876" x2="1876" y1="442.8594" y2="2052.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2381.5" x2="2381.5" y1="112.4863" y2="273.5508"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="2381.5" x2="2381.5" y1="273.5508" y2="314.5059"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2381.5" x2="2381.5" y1="314.5059" y2="401.9043"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="2381.5" x2="2381.5" y1="401.9043" y2="442.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2381.5" x2="2381.5" y1="442.8594" y2="2052.4297"/><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="88" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="95" y="97.5332">PISP Server</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="88" y="2051.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="95" y="2071.9648">PISP Server</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="191" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="198" y="97.5332">auth-service</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="191" y="2051.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="198" y="2071.9648">auth-service</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="580" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="587" y="97.5332">Switch</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="580" y="2051.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="587" y="2071.9648">Switch</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="39" x="652" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="25" x="659" y="97.5332">ALS</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="39" x="652" y="2051.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="25" x="659" y="2071.9648">ALS</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="705" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="712" y="81.0449">DFSP A</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="712.5" y="97.5332">(Payer)</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="705" y="2051.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="712" y="2071.9648">DFSP A</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="712.5" y="2088.4531">(Payer)</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="76" x="891" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="62" x="898" y="97.5332">3p-sa-in</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="76" x="891" y="2051.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="62" x="898" y="2071.9648">3p-sa-in</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="1203" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="1210" y="97.5332">3p-sa-out</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="1203" y="2051.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="1210" y="2071.9648">3p-sa-out</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="82" x="1493" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="1500" y="97.5332">sdk-sa-in</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="82" x="1493" y="2051.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="1500" y="2071.9648">sdk-sa-in</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1828" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="1835" y="97.5332">sdk-sa-out</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1828" y="2051.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="1835" y="2071.9648">sdk-sa-out</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="2348.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="2357" y="81.0449">DFSP B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="2355.5" y="97.5332">(Payee)</text><rect fill="#FEFECE" filter="url(#f17mirdyyahe60)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="2348.5" y="2051.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="2357" y="2071.9648">DFSP B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="2355.5" y="2088.4531">(Payee)</text><path d="M271,127.4863 L271,152.4863 L946,152.4863 L946,137.4863 L936,127.4863 L271,127.4863 " fill="#FBFB77" filter="url(#f17mirdyyahe60)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M936,127.4863 L936,137.4863 L946,137.4863 L936,127.4863 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="654" x="277" y="145.0547">This document aims to demonstrate the high level API Calls between the PISP, Mojaloop Hub and DFSPs.</text><rect fill="#EEEEEE" filter="url(#f17mirdyyahe60)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2420.5" x="0" y="182.4521"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="2420.5" y1="182.4521" y2="182.4521"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="2420.5" y1="185.4521" y2="185.4521"/><rect fill="#EEEEEE" filter="url(#f17mirdyyahe60)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="148" x="1136.25" y="171.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="1142.25" y="188.3652">Discovery (Lookup)</text><path d="M7,210.1074 L7,235.1074 L257,235.1074 L257,220.1074 L247,210.1074 L7,210.1074 " fill="#FBFB77" filter="url(#f17mirdyyahe60)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M247,210.1074 L247,220.1074 L257,220.1074 L247,210.1074 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="13" y="227.6758">PISPTransactionModel Lookup phase</text><polygon fill="#A80036" points="599,261.5508,609,265.5508,599,269.5508,603,265.5508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="134.5" x2="605" y1="265.5508" y2="265.5508"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="141.5" y="260.4849">GET /parties/MSISDN/+4412345678</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="239" x="1138.75" y="298.1855">Get participants/parties flow not shown here</text><polygon fill="#A80036" points="2370,331.6387,2380,335.6387,2370,339.6387,2374,335.6387" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="611" x2="2376" y1="335.6387" y2="335.6387"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="618" y="330.5728">GET /parties/MSISDN/+4412345678</text><polygon fill="#A80036" points="622,360.7715,612,364.7715,622,368.7715,618,364.7715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616" x2="2381" y1="364.7715" y2="364.7715"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="628" y="359.7056">PUT /parties/MSISDN/+4412345678</text><polygon fill="#A80036" points="145.5,389.9043,135.5,393.9043,145.5,397.9043,141.5,393.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="139.5" x2="610" y1="393.9043" y2="393.9043"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="151.5" y="388.8384">PUT /parties/MSISDN/+4412345678</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="217" x="1149.75" y="426.5391">PISP confirms payee party with their user</text><rect fill="#EEEEEE" filter="url(#f17mirdyyahe60)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2420.5" x="0" y="463.5146"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="2420.5" y1="463.5146" y2="463.5146"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="2420.5" y1="466.5146" y2="466.5146"/><rect fill="#EEEEEE" filter="url(#f17mirdyyahe60)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="138" x="1141.25" y="452.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="1147.25" y="469.4277">Agreement Phase</text><path d="M9,491.1699 L9,516.1699 L256,516.1699 L256,501.1699 L246,491.1699 L9,491.1699 " fill="#FBFB77" filter="url(#f17mirdyyahe60)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M246,491.1699 L246,501.1699 L256,501.1699 L246,491.1699 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="15" y="508.7383">PISPTransactionModel Initiate phase</text><polygon fill="#A80036" points="599,542.6133,609,546.6133,599,550.6133,603,546.6133" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="134.5" x2="605" y1="546.6133" y2="546.6133"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="141.5" y="541.5474">POST /thirdpartyRequests/transactions</text><polygon fill="#A80036" points="919,571.7461,929,575.7461,919,579.7461,923,575.7461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="611" x2="925" y1="575.7461" y2="575.7461"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="618" y="570.6802">POST /thirdpartyRequests/transactions</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="931" x2="973" y1="635.6777" y2="635.6777"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="973" x2="973" y1="635.6777" y2="648.6777"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="932" x2="973" y1="648.6777" y2="648.6777"/><polygon fill="#A80036" points="942,644.6777,932,648.6777,942,652.6777,938,648.6777" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="938" y="600.3145">Lookup this</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1017" y="599.9907">consentId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1089" y="600.3145">,</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="1097" y="599.9907">sourceAccountId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1221" y="600.3145"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="938" y="615.625">and</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="965" y="615.3013">pispId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="1013" y="615.625">. Verify that they exist, and consent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="938" y="630.9355">is granted with a valid credential</text><polygon fill="#A80036" points="1864,673.9883,1874,677.9883,1864,681.9883,1868,677.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="931" x2="1870" y1="677.9883" y2="677.9883"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="938" y="673.2461">sync POST /requestToPayTransfer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1876" x2="1918" y1="707.2988" y2="707.2988"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1918" x2="1918" y1="707.2988" y2="720.2988"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1877" x2="1918" y1="720.2988" y2="720.2988"/><polygon fill="#A80036" points="1887,716.2988,1877,720.2988,1887,724.2988,1883,720.2988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="492" x="1883" y="702.5566">OutboundRequestToPayTransferModel starts workflow with PISP Authorization</text><polygon fill="#A80036" points="622,745.4316,612,749.4316,622,753.4316,618,749.4316" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616" x2="1875" y1="749.4316" y2="749.4316"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="628" y="744.3657">POST /quotes</text><polygon fill="#A80036" points="2370,774.5645,2380,778.5645,2370,782.5645,2374,778.5645" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="611" x2="2376" y1="778.5645" y2="778.5645"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="618" y="773.4985">POST /quotes</text><polygon fill="#A80036" points="622,803.6973,612,807.6973,622,811.6973,618,807.6973" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616" x2="2381" y1="807.6973" y2="807.6973"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="628" y="802.6313">PUT /quotes/456</text><polygon fill="#A80036" points="1864,832.8301,1874,836.8301,1864,840.8301,1868,836.8301" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="611" x2="1870" y1="836.8301" y2="836.8301"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="618" y="831.7642">PUT /quotes/456</text><path d="M461,849.8301 L461,889.8301 L729,889.8301 L729,859.8301 L719,849.8301 L461,849.8301 " fill="#FBFB77" filter="url(#f17mirdyyahe60)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M719,849.8301 L719,859.8301 L729,859.8301 L719,849.8301 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="467" y="867.3984">DFSPA has the quote, they can now ask</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="467" y="882.709">the PISP for authorization</text><polygon fill="#A80036" points="622,916.584,612,920.584,622,924.584,618,920.584" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616" x2="1875" y1="920.584" y2="920.584"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="628" y="915.5181">POST /authorizations</text><polygon fill="#A80036" points="145.5,945.7168,135.5,949.7168,145.5,953.7168,141.5,949.7168" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="139.5" x2="610" y1="949.7168" y2="949.7168"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="151.5" y="944.6509">POST /authorizations</text><path d="M139,962.7168 L139,1002.7168 L492,1002.7168 L492,972.7168 L482,962.7168 L139,962.7168 " fill="#FBFB77" filter="url(#f17mirdyyahe60)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M482,962.7168 L482,972.7168 L492,972.7168 L482,962.7168 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="145" y="980.2852">PISP checks the quote with the user,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="332" x="145" y="995.5957">and uses FIDO to sign the the QuoteResponse object</text><path d="M5,1017.3379 L5,1042.3379 L260,1042.3379 L260,1027.3379 L250,1017.3379 L5,1017.3379 " fill="#FBFB77" filter="url(#f17mirdyyahe60)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M250,1017.3379 L250,1027.3379 L260,1027.3379 L250,1017.3379 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="11" y="1034.9063">PISPTransactionModel Approve phase</text><polygon fill="#A80036" points="599,1068.7813,609,1072.7813,599,1076.7813,603,1072.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="134.5" x2="605" y1="1072.7813" y2="1072.7813"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="141.5" y="1067.7153">PUT /authorizations/123</text><polygon fill="#A80036" points="1524,1097.9141,1534,1101.9141,1524,1105.9141,1528,1101.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="611" x2="1530" y1="1101.9141" y2="1101.9141"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="618" y="1096.8481">PUT /authorizations/123</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1536" x2="1578" y1="1146.5352" y2="1146.5352"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1578" x2="1578" y1="1146.5352" y2="1159.5352"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1537" x2="1578" y1="1159.5352" y2="1159.5352"/><polygon fill="#A80036" points="1547,1155.5352,1537,1159.5352,1547,1163.5352,1543,1159.5352" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="1543" y="1126.4824">Lookup the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="1618" y="1126.1587">thirdpartyRequests/transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1543" y="1141.793">request, get the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1646" y="1141.4692">consentId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="1722" y="1141.793">and</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="1749" y="1141.4692">sourceAccountId</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1536" x2="1578" y1="1204.1563" y2="1204.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1578" x2="1578" y1="1204.1563" y2="1217.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1537" x2="1578" y1="1217.1563" y2="1217.1563"/><polygon fill="#A80036" points="1547,1213.1563,1537,1217.1563,1547,1221.1563,1543,1217.1563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="1543" y="1184.1035">Confirm pispId from</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="1675" y="1183.7798">PUT /authorizations/123</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="1547" y="1199.4141">matches the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="1628" y="1199.0903">thirdpartyRequests/transaction</text><polygon fill="#A80036" points="1259,1242.4668,1249,1246.4668,1259,1250.4668,1255,1246.4668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1253" x2="1535" y1="1246.4668" y2="1246.4668"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="1265" y="1241.7246">sync call POST /verify-authorization</text><path d="M509,1259.4668 L509,1299.4668 L963,1299.4668 L963,1269.4668 L953,1259.4668 L509,1259.4668 " fill="#FBFB77" filter="url(#f17mirdyyahe60)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M953,1259.4668 L953,1269.4668 L963,1269.4668 L953,1259.4668 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="515" y="1277.0352">Switch has the signed condition</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="433" x="515" y="1292.3457">For 3rd party FIDO, it now needs to make sure everything checks out</text><polygon fill="#A80036" points="622,1341.3535,612,1345.3535,622,1349.3535,618,1345.3535" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616" x2="1247" y1="1345.3535" y2="1345.3535"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="628" y="1325.1548">POST /thirdpartyRequests/transactions</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="668" y="1340.2876">/123/authorizations</text><polygon fill="#A80036" points="254,1385.6191,244,1389.6191,254,1393.6191,250,1389.6191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="248" x2="610" y1="1389.6191" y2="1389.6191"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="260" y="1369.4204">POST /thirdpartyRequests/transactions</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="300" y="1384.5532">/123/authorizations</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="285" y1="1418.9297" y2="1418.9297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="285" x2="285" y1="1418.9297" y2="1431.9297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="244" x2="285" y1="1431.9297" y2="1431.9297"/><polygon fill="#A80036" points="254,1427.9297,244,1431.9297,254,1435.9297,250,1431.9297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="250" y="1414.1875">Lookup this consent based on consentId</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="285" y1="1461.2402" y2="1461.2402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="285" x2="285" y1="1461.2402" y2="1474.2402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="244" x2="285" y1="1474.2402" y2="1474.2402"/><polygon fill="#A80036" points="254,1470.2402,244,1474.2402,254,1478.2402,250,1474.2402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="354" x="250" y="1456.498">Ensure the sourceAccountId matches what is in Consent</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="285" y1="1518.8613" y2="1518.8613"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="285" x2="285" y1="1518.8613" y2="1531.8613"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="244" x2="285" y1="1531.8613" y2="1531.8613"/><polygon fill="#A80036" points="254,1527.8613,244,1531.8613,254,1535.8613,250,1531.8613" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="250" y="1498.8086">Check that the signed bytes match the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="250" y="1514.1191">publickey we have stored for the consent</text><polygon fill="#A80036" points="599,1572.127,609,1576.127,599,1580.127,603,1576.127" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="605" y1="1576.127" y2="1576.127"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="250" y="1555.9282">PUT /thirdpartyRequests/transactions</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="282" y="1571.061">/123/authorizations</text><polygon fill="#A80036" points="1236,1616.3926,1246,1620.3926,1236,1624.3926,1240,1620.3926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="611" x2="1242" y1="1620.3926" y2="1620.3926"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="618" y="1600.1938">PUT /thirdpartyRequests/transactions</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="650" y="1615.3267">/123/authorizations</text><polygon fill="#A80036" points="1524,1645.7031,1534,1649.7031,1524,1653.7031,1528,1649.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1248" x2="1530" y1="1649.7031" y2="1649.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="1255" y="1644.9609">sync response POST /verify-authorization</text><path d="M551,1662.7031 L551,1702.7031 L920,1702.7031 L920,1672.7031 L910,1662.7031 L551,1662.7031 " fill="#FBFB77" filter="url(#f17mirdyyahe60)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M910,1662.7031 L910,1672.7031 L920,1672.7031 L910,1662.7031 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="557" y="1680.2715">DFSPA now knows that the user signed this transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="557" y="1695.582">and can go ahead and initiate the transfer</text><rect fill="#EEEEEE" filter="url(#f17mirdyyahe60)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2420.5" x="0" y="1732.9795"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="2420.5" y1="1732.9795" y2="1732.9795"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="2420.5" y1="1735.9795" y2="1735.9795"/><rect fill="#EEEEEE" filter="url(#f17mirdyyahe60)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="120" x="1150.25" y="1722.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="1156.25" y="1738.8926">Transfer Phase</text><polygon fill="#A80036" points="622,1772.9453,612,1776.9453,622,1780.9453,618,1776.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616" x2="737" y1="1776.9453" y2="1776.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="628" y="1772.2031">POST /transfers</text><polygon fill="#A80036" points="2370,1802.2559,2380,1806.2559,2370,1810.2559,2374,1806.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="611" x2="2376" y1="1806.2559" y2="1806.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="618" y="1801.5137">POST /transfers</text><polygon fill="#A80036" points="622,1831.5664,612,1835.5664,622,1839.5664,618,1835.5664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="616" x2="2381" y1="1835.5664" y2="1835.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="628" y="1830.8242">PUT /transfers/321</text><polygon fill="#A80036" points="1524,1860.877,1534,1864.877,1524,1868.877,1528,1864.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="611" x2="1530" y1="1864.877" y2="1864.877"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="618" y="1860.1348">PUT /transfers/321</text><polygon fill="#A80036" points="1864,1890.1875,1874,1894.1875,1864,1898.1875,1868,1894.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1536" x2="1870" y1="1894.1875" y2="1894.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="1543" y="1889.4453">notify via redis-cache</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1876" x2="1918" y1="1923.498" y2="1923.498"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1918" x2="1918" y1="1923.498" y2="1936.498"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1877" x2="1918" y1="1936.498" y2="1936.498"/><polygon fill="#A80036" points="1887,1932.498,1877,1936.498,1887,1940.498,1883,1936.498" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="336" x="1883" y="1918.7559">OutboundRequestToPayTransferModel workflow ends</text><polygon fill="#A80036" points="942,1961.8086,932,1965.8086,942,1969.8086,938,1965.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="936" x2="1875" y1="1965.8086" y2="1965.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="948" y="1961.0664">sync response POST /requestToPayTransfer</text><path d="M597,1978.8086 L597,2003.8086 L1260,2003.8086 L1260,1988.8086 L1250,1978.8086 L597,1978.8086 " fill="#FBFB77" filter="url(#f17mirdyyahe60)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1250,1978.8086 L1250,1988.8086 L1260,1988.8086 L1250,1978.8086 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="642" x="603" y="1996.377">DFSPA 3psa_in now knows that transfer initiated by PISP has ended and notify PISP about the outcome</text><polygon fill="#A80036" points="145.5,2030.4297,135.5,2034.4297,145.5,2038.4297,141.5,2034.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="139.5" x2="930" y1="2034.4297" y2="2034.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="289" x="151.5" y="2029.6875">PATCH /thirdpartyRequests/transactions/123</text><!--MD5=[ddb50695a1da8363be5290f996ba19cb]
@startuml

title PISPTransferSimpleAPI

!include participants_api.iuml

note over S
This document aims to demonstrate the high level API Calls between the PISP, Mojaloop Hub and DFSPs.
end note


== Discovery (Lookup) ==
note over D1
PISPTransactionModel Lookup phase
end note

D1 -> S: ""GET /parties/MSISDN/+4412345678""
... Get participants/parties flow not shown here ...
S -> D3: ""GET /parties/MSISDN/+4412345678""
D3 -> S: ""PUT /parties/MSISDN/+4412345678""
S -> D1: ""PUT /parties/MSISDN/+4412345678""
... PISP confirms payee party with their user ...

== Agreement Phase ==
note over D1
PISPTransactionModel Initiate phase
end note

D1 -> S: ""POST /thirdpartyRequests/transactions""
S -> D2_3psa_in: ""POST /thirdpartyRequests/transactions""

D2_3psa_in -> D2_3psa_in: Lookup this ""consentId"", ""sourceAccountId"" \nand ""pispId"". Verify that they exist, and consent \nis granted with a valid credential

D2_3psa_in -> D2_sdksa_out: sync POST /requestToPayTransfer
D2_sdksa_out -> D2_sdksa_out: OutboundRequestToPayTransferModel starts workflow with PISP Authorization
D2_sdksa_out -> S: ""POST /quotes""
S -> D3: ""POST /quotes""
D3 -> S: ""PUT /quotes/456""
S -> D2_sdksa_out: ""PUT /quotes/456""

note left of D2
  DFSPA has the quote, they can now ask
  the PISP for authorization
end note

D2_sdksa_out -> S: ""POST /authorizations""
S -> D1: ""POST /authorizations""

note right of D1
  PISP checks the quote with the user,
  and uses FIDO to sign the the QuoteResponse object
end note

note over D1
PISPTransactionModel Approve phase
end note

D1 -> S: ""PUT /authorizations/123""
S -> D2_sdksa_in: ""PUT /authorizations/123""

D2_sdksa_in ->D2_sdksa_in: Lookup the ""thirdpartyRequests/transaction""\nrequest, get the ""consentId"" and ""sourceAccountId""
D2_sdksa_in -> D2_sdksa_in: Confirm pispId from ""PUT /authorizations/123""\n matches the ""thirdpartyRequests/transaction""

D2_sdksa_in -> D2_3psa_out: sync call POST /verify-authorization

note over D2
  Switch has the signed condition
  For 3rd party FIDO, it now needs to make sure everything checks out
end note

D2_3psa_out -> S: ""POST /thirdpartyRequests/transactions""\n""     /123/authorizations""
S -> AUTHS: ""POST /thirdpartyRequests/transactions""\n""     /123/authorizations""

AUTHS -> AUTHS: Lookup this consent based on consentId
AUTHS -> AUTHS: Ensure the sourceAccountId matches what is in Consent
AUTHS -> AUTHS: Check that the signed bytes match the \npublickey we have stored for the consent

AUTHS -> S: ""PUT /thirdpartyRequests/transactions""\n""    /123/authorizations""
S -> D2_3psa_out: ""PUT /thirdpartyRequests/transactions""\n""    /123/authorizations""

D2_3psa_out -> D2_sdksa_in: sync response POST /verify-authorization

note over D2
  DFSPA now knows that the user signed this transaction
  and can go ahead and initiate the transfer
end note

== Transfer Phase ==

D2 -> S: POST /transfers
S -> D3: POST /transfers
D3 -> S: PUT /transfers/321
S -> D2_sdksa_in: PUT /transfers/321
D2_sdksa_in -> D2_sdksa_out: notify via redis-cache 
D2_sdksa_out -> D2_sdksa_out: OutboundRequestToPayTransferModel workflow ends 
D2_sdksa_out -> D2_3psa_in: sync response POST /requestToPayTransfer

note over D2_3psa_in
  DFSPA 3psa_in now knows that transfer initiated by PISP has ended and notify PISP about the outcome
end note
D2_3psa_in -> D1: PATCH /thirdpartyRequests/transactions/123

@enduml

@startuml

title PISPTransferSimpleAPI

box "PISP"
participant "PISP Server" as D1
end box
box "Mojaloop"
    participant "auth-service" as AUTHS
    participant Switch as S
    participant "ALS" as A
end box
box "DFSP A"
    participant "DFSP A\n(Payer)" as D2
    participant "3p-sa-in" as D2_3psa_in
    participant "3p-sa-out" as D2_3psa_out
    participant "sdk-sa-in" as D2_sdksa_in
    participant "sdk-sa-out" as D2_sdksa_out
end box
box "DFSP B"
    participant "DFSP B\n(Payee)" as D3
end box

note over S
This document aims to demonstrate the high level API Calls between the PISP, Mojaloop Hub and DFSPs.
end note


== Discovery (Lookup) ==
note over D1
PISPTransactionModel Lookup phase
end note

D1 -> S: ""GET /parties/MSISDN/+4412345678""
... Get participants/parties flow not shown here ...
S -> D3: ""GET /parties/MSISDN/+4412345678""
D3 -> S: ""PUT /parties/MSISDN/+4412345678""
S -> D1: ""PUT /parties/MSISDN/+4412345678""
... PISP confirms payee party with their user ...

== Agreement Phase ==
note over D1
PISPTransactionModel Initiate phase
end note

D1 -> S: ""POST /thirdpartyRequests/transactions""
S -> D2_3psa_in: ""POST /thirdpartyRequests/transactions""

D2_3psa_in -> D2_3psa_in: Lookup this ""consentId"", ""sourceAccountId"" \nand ""pispId"". Verify that they exist, and consent \nis granted with a valid credential

D2_3psa_in -> D2_sdksa_out: sync POST /requestToPayTransfer
D2_sdksa_out -> D2_sdksa_out: OutboundRequestToPayTransferModel starts workflow with PISP Authorization
D2_sdksa_out -> S: ""POST /quotes""
S -> D3: ""POST /quotes""
D3 -> S: ""PUT /quotes/456""
S -> D2_sdksa_out: ""PUT /quotes/456""

note left of D2
  DFSPA has the quote, they can now ask
  the PISP for authorization
end note

D2_sdksa_out -> S: ""POST /authorizations""
S -> D1: ""POST /authorizations""

note right of D1
  PISP checks the quote with the user,
  and uses FIDO to sign the the QuoteResponse object
end note

note over D1
PISPTransactionModel Approve phase
end note

D1 -> S: ""PUT /authorizations/123""
S -> D2_sdksa_in: ""PUT /authorizations/123""

D2_sdksa_in ->D2_sdksa_in: Lookup the ""thirdpartyRequests/transaction""\nrequest, get the ""consentId"" and ""sourceAccountId""
D2_sdksa_in -> D2_sdksa_in: Confirm pispId from ""PUT /authorizations/123""\n matches the ""thirdpartyRequests/transaction""

D2_sdksa_in -> D2_3psa_out: sync call POST /verify-authorization

note over D2
  Switch has the signed condition
  For 3rd party FIDO, it now needs to make sure everything checks out
end note

D2_3psa_out -> S: ""POST /thirdpartyRequests/transactions""\n""     /123/authorizations""
S -> AUTHS: ""POST /thirdpartyRequests/transactions""\n""     /123/authorizations""

AUTHS -> AUTHS: Lookup this consent based on consentId
AUTHS -> AUTHS: Ensure the sourceAccountId matches what is in Consent
AUTHS -> AUTHS: Check that the signed bytes match the \npublickey we have stored for the consent

AUTHS -> S: ""PUT /thirdpartyRequests/transactions""\n""    /123/authorizations""
S -> D2_3psa_out: ""PUT /thirdpartyRequests/transactions""\n""    /123/authorizations""

D2_3psa_out -> D2_sdksa_in: sync response POST /verify-authorization

note over D2
  DFSPA now knows that the user signed this transaction
  and can go ahead and initiate the transfer
end note

== Transfer Phase ==

D2 -> S: POST /transfers
S -> D3: POST /transfers
D3 -> S: PUT /transfers/321
S -> D2_sdksa_in: PUT /transfers/321
D2_sdksa_in -> D2_sdksa_out: notify via redis-cache 
D2_sdksa_out -> D2_sdksa_out: OutboundRequestToPayTransferModel workflow ends 
D2_sdksa_out -> D2_3psa_in: sync response POST /requestToPayTransfer

note over D2_3psa_in
  DFSPA 3psa_in now knows that transfer initiated by PISP has ended and notify PISP about the outcome
end note
D2_3psa_in -> D1: PATCH /thirdpartyRequests/transactions/123

@enduml

PlantUML version 1.2020.18(Thu Oct 01 03:40:44 PHT 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>