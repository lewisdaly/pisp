<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1486px" preserveAspectRatio="none" style="width:1549px;height:1486px;" version="1.1" viewBox="0 0 1549 1486" width="1549px" zoomAndPan="magnify"><defs><filter height="300%" id="fbs5xpjonn92m" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="1441.0469" style="stroke: #A80036; stroke-width: 1.0;" width="779" x="553.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="61" x="912.5" y="47.0566">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="345" x="600" y="23.5352">PISP Linking: Credential registration (challenge)</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="26" x2="26" y1="89.2871" y2="1434.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="649" x2="649" y1="89.2871" y2="1434.0469"/><rect fill="#FFFFFF" filter="url(#fbs5xpjonn92m)" height="166.6406" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="644" y="148.6855"/><rect fill="#FFFFFF" filter="url(#fbs5xpjonn92m)" height="133.1523" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="644" y="420.4785"/><rect fill="#FFFFFF" filter="url(#fbs5xpjonn92m)" height="439.3633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="644" y="976.6836"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1015" x2="1015" y1="89.2871" y2="1434.0469"/><rect fill="#FFFFFF" filter="url(#fbs5xpjonn92m)" height="163.7734" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1010" y="286.0156"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1277" x2="1277" y1="89.2871" y2="1434.0469"/><rect fill="#FFFFFF" filter="url(#fbs5xpjonn92m)" height="481.6738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1272" y="524.3203"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1516" x2="1516" y1="89.2871" y2="1434.0469"/><rect fill="#FEFECE" filter="url(#fbs5xpjonn92m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="3" y="53.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="10" y="74.334">PISP</text><rect fill="#FEFECE" filter="url(#fbs5xpjonn92m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="557.5" y="53.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="564.5" y="74.334">Thirdparty-API-Adapter</text><rect fill="#FEFECE" filter="url(#fbs5xpjonn92m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="177" x="924.5" y="53.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="163" x="931.5" y="74.334">Account Lookup Service</text><rect fill="#FEFECE" filter="url(#fbs5xpjonn92m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="1225.5" y="53.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="1232.5" y="74.334">Auth Service</text><rect fill="#FEFECE" filter="url(#fbs5xpjonn92m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="48" x="1490" y="53.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="34" x="1497" y="74.334">DFSP</text><rect fill="#FEFECE" filter="url(#fbs5xpjonn92m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="3" y="1434.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="10" y="1454.582">PISP</text><rect fill="#FEFECE" filter="url(#fbs5xpjonn92m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="557.5" y="1434.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="564.5" y="1454.582">Thirdparty-API-Adapter</text><rect fill="#FEFECE" filter="url(#fbs5xpjonn92m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="177" x="924.5" y="1434.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="163" x="931.5" y="1454.582">Account Lookup Service</text><rect fill="#FEFECE" filter="url(#fbs5xpjonn92m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="1225.5" y="1434.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="1232.5" y="1454.582">Auth Service</text><rect fill="#FEFECE" filter="url(#fbs5xpjonn92m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="48" x="1490" y="1434.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="34" x="1497" y="1454.582">DFSP</text><polygon fill="#A80036" points="632,144.6855,642,148.6855,632,152.6855,636,148.6855" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="638" y1="148.6855" y2="148.6855"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="33" y="128.8994">CRED-1</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="90" y="113.354">POST /consents/123/generateChallenge</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="106" y="128.4868">FSIOP-Source: pispa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="106" y="143.6196">{}</text><polygon fill="#A80036" points="37,173.9961,27,177.9961,37,181.9961,33,177.9961" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="31" x2="643" y1="177.9961" y2="177.9961"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="43" y="173.2539">CRED-2</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="100" y="172.8413">202 Accepted</text><rect fill="#FFFFFF" filter="url(#fbs5xpjonn92m)" height="38" style="stroke: #A80036; stroke-width: 1.0;" width="428" x="659" y="190.9961"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="663" y="207.5645">Switch performs account lookup for consentId</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="959" y="207.2407">123</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="663" y="222.875">and determines the auth service for this consent is</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="987" y="222.5513">central-auth</text><polygon fill="#A80036" points="998,282.0156,1008,286.0156,998,290.0156,1002,286.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="654" x2="1004" y1="286.0156" y2="286.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="661" y="266.2295">CRED-3</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="718" y="250.6841">GET /participants/CONSENTS/123</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="734" y="265.8169">FSIOP-Source: Switch</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="734" y="280.9497">FSIOP-Destination: Account Lookup</text><polygon fill="#A80036" points="665,311.3262,655,315.3262,665,319.3262,661,315.3262" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="659" x2="1009" y1="315.3262" y2="315.3262"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="671" y="310.584">CRED-4</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="728" y="310.1714">202 Accepted</text><polygon fill="#A80036" points="665,416.4785,655,420.4785,665,424.4785,661,420.4785" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="659" x2="1009" y1="420.4785" y2="420.4785"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="671" y="377.8154">CRED-5</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="728" y="339.3931">PUT /participants/CONSENTS/123</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="744" y="354.5259">FSIOP-Source: Account Lookup</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="744" y="369.6587">FSIOP-Destination: Switch</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="744" y="384.7915">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="744" y="400.4258"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="760" y="400.1021">fspId: "central-auth",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="744" y="415.7363"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="744" y="415.4126">}</text><polygon fill="#A80036" points="998,445.7891,1008,449.7891,998,453.7891,1002,449.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="654" x2="1004" y1="449.7891" y2="449.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="661" y="445.0469">CRED-6</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="718" y="444.6343">200 OK</text><polygon fill="#A80036" points="1260,520.3203,1270,524.3203,1260,528.3203,1264,524.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="654" x2="1266" y1="524.3203" y2="524.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="661" y="496.9678">CRED-7</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="718" y="473.856">POST /consents/123/generateChallenge</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="734" y="488.9888">FSIOP-Source: pispa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="734" y="504.1216">FSIOP-Destination: central-auth</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="742" y="519.2544">{}</text><polygon fill="#A80036" points="665,549.6309,655,553.6309,665,557.6309,661,553.6309" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="659" x2="1271" y1="553.6309" y2="553.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="671" y="548.8887">CRED-8</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="728" y="548.4761">202 Accepted</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1282" x2="1324" y1="582.9414" y2="582.9414"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1324" x2="1324" y1="582.9414" y2="595.9414"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1283" x2="1324" y1="595.9414" y2="595.9414"/><polygon fill="#A80036" points="1293,591.9414,1283,595.9414,1293,599.9414,1289,595.9414" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="1289" y="578.1992">CRED-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="1346" y="578.1992">Generate a new challenge.</text><polygon fill="#A80036" points="665,972.6836,655,976.6836,665,980.6836,661,976.6836" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="659" x2="1271" y1="976.6836" y2="976.6836"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="671" y="796.2256">CRED-10</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="737" y="620.0083">PUT /consents/123</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="753" y="635.1411">FSIOP-Source: central-auth</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="753" y="650.2739">FSIOP-Destination: pispa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="753" y="665.4067">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="681.041"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="769" y="680.7173">requestId: "456",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="696.3516"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="769" y="696.0278">initiatorId: "pispa",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="711.6621"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="769" y="711.3384">participantId: "dfspa",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="726.9727"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="769" y="726.6489">scopes: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="742.2832"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="785" y="741.9595">{ accountId: "dfsp.username.1234",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="757.5938"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="801" y="757.27">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="772.9043"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="785" y="772.5806">{ accountId: "dfsp.username.5678",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="788.2148"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="801" y="787.8911">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="803.5254"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="769" y="803.2017">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="818.8359"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="769" y="818.5122"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="232" x="769" y="818.5122">credential: { // This is new!</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="834.1465"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="785" y="833.8228"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="785" y="833.8228">id: null,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="849.457"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="785" y="849.1333"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="400" x="785" y="849.1333">credentialType: "FIDO", // TODO: Is this required?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="864.7676"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="785" y="864.4438"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="785" y="864.4438">status: "PENDING",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="880.0781"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="785" y="879.7544"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="96" x="785" y="879.7544">challenge: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="895.3887"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="801" y="895.0649"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="168" x="801" y="895.0649">payload: base64(...),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="910.6992"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="801" y="910.3755"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="801" y="910.3755">signature: null,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="926.0098"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="785" y="925.686"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="785" y="925.686">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="941.3203"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="785" y="940.9966"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="785" y="940.9966">payload: null,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="956.6309"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="769" y="956.3071"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="769" y="956.3071">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="753" y="971.9414"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="753" y="971.6177">}</text><polygon fill="#A80036" points="1260,1001.9941,1270,1005.9941,1260,1009.9941,1264,1005.9941" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="654" x2="1266" y1="1005.9941" y2="1005.9941"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="661" y="1001.252">CRED-11</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="727" y="1000.8394">202 Accepted</text><polygon fill="#A80036" points="37,1382.7363,27,1386.7363,37,1390.7363,33,1386.7363" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="31" x2="643" y1="1386.7363" y2="1386.7363"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="43" y="1206.2783">CRED-12</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="109" y="1030.061">PUT /consents/123</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="125" y="1045.1938">FSIOP-Source: central-auth</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="125" y="1060.3267">FSIOP-Destination: pispa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="117" y="1075.4595">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1091.0938"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="141" y="1090.77">requestId: "456",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1106.4043"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="141" y="1106.0806">initiatorId: "pispa",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1121.7148"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="141" y="1121.3911">participantId: "dfspa",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1137.0254"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="141" y="1136.7017">scopes: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1152.3359"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="157" y="1152.0122">{ accountId: "dfsp.username.1234",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1167.6465"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="173" y="1167.3228">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1182.957"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="157" y="1182.6333">{ accountId: "dfsp.username.5678",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1198.2676"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="173" y="1197.9438">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1213.5781"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="141" y="1213.2544">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1228.8887"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="141" y="1228.5649"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="232" x="141" y="1228.5649">credential: { // This is new!</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1244.1992"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="157" y="1243.8755"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="157" y="1243.8755">id: null,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1259.5098"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="157" y="1259.186"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="184" x="157" y="1259.186">credentialType: "FIDO",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1274.8203"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="157" y="1274.4966"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="157" y="1274.4966">status: "PENDING",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1290.1309"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="157" y="1289.8071"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="96" x="157" y="1289.8071">challenge: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1305.4414"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="173" y="1305.1177"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="168" x="173" y="1305.1177">payload: base64(...),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1320.752"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="173" y="1320.4282"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="173" y="1320.4282">signature: null,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1336.0625"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="157" y="1335.7388"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="157" y="1335.7388">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1351.373"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="157" y="1351.0493"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="157" y="1351.0493">payload: null,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1366.6836"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="141" y="1366.3599"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="141" y="1366.3599">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="1381.9941"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="125" y="1381.6704">}</text><polygon fill="#A80036" points="632,1412.0469,642,1416.0469,632,1420.0469,636,1416.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="26" x2="638" y1="1416.0469" y2="1416.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="33" y="1411.3047">CRED-13</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="99" y="1410.8921">202 Accepted</text><!--
@startuml

!pragma teoz true

title PISP Linking: Credential registration (challenge)

participant "PISP" as PISP

box "Mojaloop"
    participant "Thirdparty-API-Adapter" as Switch
    participant "Account Lookup Service" as ALS
    participant "Auth Service" as Auth
end box

participant "DFSP" as DFSP

autonumber 1 "<b>CRED-#</b>"
PISP -> Switch ++: ""POST /consents/123/generateChallenge""\n""  FSIOP-Source: pispa""\n""  {}""
Switch - -> PISP: ""202 Accepted""
deactivate PISP

rnote right of Switch #Light
    Switch performs account lookup for consentId ""123""
    and determines the auth service for this consent is ""central-auth""
end note

Switch -> ALS ++: ""GET /participants/CONSENTS/123""\n""  FSIOP-Source: Switch""\n""  FSIOP-Destination: Account Lookup""
ALS - -> Switch: ""202 Accepted""
deactivate Switch

ALS -> Switch ++: ""PUT /participants/CONSENTS/123""\n""  FSIOP-Source: Account Lookup""\n""  FSIOP-Destination: Switch""\n""  {""\n    ""  fspId: "central-auth",""\n    ""}""
Switch - -> ALS: ""200 OK""
deactivate ALS


Switch -> Auth ++: ""POST /consents/123/generateChallenge""\n""  FSIOP-Source: pispa""\n""  FSIOP-Destination: central-auth""\n""   {}""
Auth - -> Switch: ""202 Accepted""
deactivate Switch

Auth -> Auth: Generate a new challenge.
Auth -> Switch ++: ""PUT /consents/123""\n""  FSIOP-Source: central-auth""\n""  FSIOP-Destination: pispa""\n""  {""\n    ""  requestId: "456",""\n    ""  initiatorId: "pispa",""\n    ""  participantId: "dfspa",""\n    ""  scopes: [ ""\n    ""    { accountId: "dfsp.username.1234",""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""    { accountId: "dfsp.username.5678",""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""  ],""\n    ""  **credential: { // This is new!**""\n    ""    **id: null,**""\n    ""    **credentialType: "FIDO", // TODO: Is this required?**""\n    ""    **status: "PENDING",**""\n    ""    **challenge: {**""\n    ""      **payload: base64(...),**""\n    ""      **signature: null,**""\n    ""    **},**""\n    ""    **payload: null,**""\n    ""  **}**""\n    ""}""
Switch - -> Auth: ""202 Accepted""
deactivate Auth

Switch -> PISP ++: ""PUT /consents/123""\n""  FSIOP-Source: central-auth""\n""  FSIOP-Destination: pispa""\n"" {""\n    ""  requestId: "456",""\n    ""  initiatorId: "pispa",""\n    ""  participantId: "dfspa",""\n    ""  scopes: [ ""\n    ""    { accountId: "dfsp.username.1234",""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""    { accountId: "dfsp.username.5678",""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""  ],""\n    ""  **credential: { // This is new!**""\n    ""    **id: null,**""\n    ""    **credentialType: "FIDO",**""\n    ""    **status: "PENDING",**""\n    ""    **challenge: {**""\n    ""      **payload: base64(...),**""\n    ""      **signature: null,**""\n    ""    **},**""\n    ""    **payload: null,**""\n    ""  **}**""\n    ""}""
PISP - -> Switch: ""202 Accepted""
deactivate Switch

@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 PHT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_171-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>