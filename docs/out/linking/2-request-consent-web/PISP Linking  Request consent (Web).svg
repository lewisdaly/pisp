<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1386px" preserveAspectRatio="none" style="width:1340px;height:1386px;" version="1.1" viewBox="0 0 1340 1386" width="1340px" zoomAndPan="magnify"><defs><filter height="300%" id="f1b3sozxs526m4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="314" x="510.5" y="29.4023">PISP Linking: Request consent (Web)</text><rect fill="#DDDDDD" height="1339.0723" style="stroke: #A80036; stroke-width: 1.0;" width="70" x="631" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="61" x="635.5" y="53.7676">Mojaloop</text><rect fill="#FFFFFF" filter="url(#f1b3sozxs526m4)" height="67.3105" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="23" y="105.998"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="23" x2="23" y1="105.998" y2="173.3086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="33" x2="33" y1="105.998" y2="173.3086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="23" x2="33" y1="105.998" y2="105.998"/><rect fill="#FFFFFF" filter="url(#f1b3sozxs526m4)" height="264.791" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="23" y="201.3086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="23" x2="23" y1="201.3086" y2="466.0996"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="33" x2="33" y1="201.3086" y2="466.0996"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="23" x2="33" y1="466.0996" y2="466.0996"/><rect fill="#FFFFFF" filter="url(#f1b3sozxs526m4)" height="77.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="23" y="1255.1621"/><rect fill="#FFFFFF" filter="url(#f1b3sozxs526m4)" height="302.1016" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661" y="436.7891"/><rect fill="#FFFFFF" filter="url(#f1b3sozxs526m4)" height="302.1016" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661" y="982.3711"/><rect fill="#FFFFFF" filter="url(#f1b3sozxs526m4)" height="302.1016" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1299" y="709.5801"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="28" x2="28" y1="95.998" y2="105.998"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="28" x2="28" y1="105.998" y2="133.998"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="28" x2="28" y1="133.998" y2="173.3086"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="28" x2="28" y1="173.3086" y2="201.3086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="28" x2="28" y1="201.3086" y2="1341.7832"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="95.998" y2="105.998"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="666" x2="666" y1="105.998" y2="133.998"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="133.998" y2="173.3086"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="666" x2="666" y1="173.3086" y2="201.3086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="201.3086" y2="1341.7832"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1304" x2="1304" y1="95.998" y2="105.998"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1304" x2="1304" y1="105.998" y2="133.998"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1304" x2="1304" y1="133.998" y2="173.3086"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1304" x2="1304" y1="173.3086" y2="201.3086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1304" x2="1304" y1="201.3086" y2="1341.7832"/><rect fill="#FEFECE" filter="url(#f1b3sozxs526m4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="12" y="81.0449">PISP</text><rect fill="#FEFECE" filter="url(#f1b3sozxs526m4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="5" y="1340.7832"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="12" y="1361.3184">PISP</text><rect fill="#FEFECE" filter="url(#f1b3sozxs526m4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="635" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="642" y="81.0449">Switch</text><rect fill="#FEFECE" filter="url(#f1b3sozxs526m4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="635" y="1340.7832"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="642" y="1361.3184">Switch</text><rect fill="#FEFECE" filter="url(#f1b3sozxs526m4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="48" x="1278" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="34" x="1285" y="81.0449">DFSP</text><rect fill="#FEFECE" filter="url(#f1b3sozxs526m4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="48" x="1278" y="1340.7832"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="34" x="1285" y="1361.3184">DFSP</text><rect fill="#FFFFFF" filter="url(#f1b3sozxs526m4)" height="67.3105" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="23" y="105.998"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="23" x2="23" y1="105.998" y2="173.3086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="33" x2="33" y1="105.998" y2="173.3086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="23" x2="33" y1="105.998" y2="105.998"/><rect fill="#FFFFFF" filter="url(#f1b3sozxs526m4)" height="264.791" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="23" y="201.3086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="23" x2="23" y1="201.3086" y2="466.0996"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="33" x2="33" y1="201.3086" y2="466.0996"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="23" x2="33" y1="466.0996" y2="466.0996"/><rect fill="#FFFFFF" filter="url(#f1b3sozxs526m4)" height="77.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="23" y="1255.1621"/><rect fill="#FFFFFF" filter="url(#f1b3sozxs526m4)" height="302.1016" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661" y="436.7891"/><rect fill="#FFFFFF" filter="url(#f1b3sozxs526m4)" height="302.1016" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661" y="982.3711"/><rect fill="#FFFFFF" filter="url(#f1b3sozxs526m4)" height="302.1016" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1299" y="709.5801"/><path d="M6,138.998 L6,163.998 L1326,163.998 L1326,148.998 L1316,138.998 L6,138.998 " fill="#FBFB77" filter="url(#f1b3sozxs526m4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1316,138.998 L1316,148.998 L1326,148.998 L1316,138.998 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="775" x="272" y="156.5664">The user initiated some sort of account linking by choosing the appropriate DFSP from a screen inside the PISP application.</text><polygon fill="#A80036" points="649,432.7891,659,436.7891,649,440.7891,653,436.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="33" x2="655" y1="436.7891" y2="436.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="40" y="324.9619">REQ-1</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="89" y="217.3755">POST /consentRequests</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="97" y="233.0098"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="113" y="232.686">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="97" y="248.3203"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="113" y="247.9966">FSIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="97" y="263.6309"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="105" y="263.3071">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="97" y="278.9414"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="113" y="278.6177">id: "456",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="97" y="294.252"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="113" y="293.9282">initiatorId: "pispa",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="97" y="309.5625"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="113" y="309.2388">scopes: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="97" y="324.873"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="129" y="324.5493">{</text><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="504" x="145" y="324.5493">accountId: "dfsp.username.1234", // This is *optional* for web.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="97" y="340.1836"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="145" y="339.8599">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="97" y="355.4941"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="129" y="355.1704">{ accountId: "dfsp.username.5678",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="97" y="370.8047"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="145" y="370.481">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="97" y="386.1152"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="113" y="385.7915">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="97" y="401.4258"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="113" y="401.1021">authChannels: [ "Web", "OTP" ],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="97" y="416.7363"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="113" y="416.4126">callbackUri: "pisp-app://callback...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="401" y="416.7363">"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="97" y="432.0469"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="97" y="431.7231">}</text><polygon fill="#A80036" points="39,462.0996,29,466.0996,39,470.0996,35,466.0996" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="33" x2="660" y1="466.0996" y2="466.0996"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="45" y="461.3574">REQ-2</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="94" y="460.9448">202 Accepted</text><polygon fill="#A80036" points="1287,705.5801,1297,709.5801,1287,713.5801,1291,709.5801" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="671" x2="1293" y1="709.5801" y2="709.5801"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="678" y="597.7529">REQ-3</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="727" y="490.1665">POST /consentRequests</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="735" y="505.8008"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="751" y="505.4771">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="735" y="521.1113"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="751" y="520.7876">FSIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="735" y="536.4219"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="743" y="536.0981">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="735" y="551.7324"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="751" y="551.4087">id: "456",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="735" y="567.043"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="751" y="566.7192">initiatorId: "pispa",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="735" y="582.3535"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="751" y="582.0298">scopes: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="735" y="597.6641"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="767" y="597.3403">{ accountId: "dfsp.username.1234",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="735" y="612.9746"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="783" y="612.6509">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="735" y="628.2852"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="767" y="627.9614">{ accountId: "dfsp.username.5678",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="735" y="643.5957"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="783" y="643.272">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="735" y="658.9063"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="751" y="658.5825">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="735" y="674.2168"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="751" y="673.8931">authChannels: [ "Web", "OTP" ],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="735" y="689.5273"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="751" y="689.2036">callbackUri: "pisp-app://callback...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1039" y="689.5273">"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="735" y="704.8379"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="735" y="704.5142">}</text><polygon fill="#A80036" points="677,734.8906,667,738.8906,677,742.8906,673,738.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="671" x2="1298" y1="738.8906" y2="738.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="683" y="734.1484">REQ-4</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="732" y="733.7358">202 Accepted</text><polygon fill="#A80036" points="682,978.3711,672,982.3711,682,986.3711,678,982.3711" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="676" x2="1298" y1="982.3711" y2="982.3711"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="688" y="870.5439">REQ-5</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="737" y="762.9575">PUT /consentRequests/456</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="745" y="778.5918"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="761" y="778.2681">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="745" y="793.9023"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="761" y="793.5786">FSIOP-Destination: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="745" y="809.2129"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="753" y="808.8892">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="745" y="824.5234"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="761" y="824.1997">initiatorId: "pispa",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="745" y="839.834"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="761" y="839.5103">scopes: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="745" y="855.1445"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="777" y="854.8208">{ accountId: "dfsp.username.1234",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="745" y="870.4551"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="793" y="870.1313">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="745" y="885.7656"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="777" y="885.4419">{ accountId: "dfsp.username.5678",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="745" y="901.0762"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="793" y="900.7524">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="745" y="916.3867"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="761" y="916.063">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="745" y="931.6973"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="761" y="931.3735">authChannels: [ "Web" ],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="745" y="947.0078"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="761" y="946.6841">callbackUri: "pisp-app://callback...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1049" y="947.0078">"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="745" y="962.3184"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="761" y="961.9946"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="536" x="761" y="961.9946">authUri: "dfspa.com/authorize?consentRequestId=456" // This is new!</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="745" y="977.6289"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="745" y="977.3052">}</text><polygon fill="#A80036" points="1292,1007.6816,1302,1011.6816,1292,1015.6816,1296,1011.6816" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="671" x2="1298" y1="1011.6816" y2="1011.6816"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="678" y="1006.9395">REQ-6</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="727" y="1006.5269">202 Accepted</text><polygon fill="#A80036" points="44,1251.1621,34,1255.1621,44,1259.1621,40,1255.1621" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="38" x2="660" y1="1255.1621" y2="1255.1621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="50" y="1143.335">REQ-7</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="99" y="1035.7485">PUT /consentRequests/456</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="107" y="1051.3828"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="123" y="1051.0591">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="107" y="1066.6934"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="123" y="1066.3696">FSIOP-Destination: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="107" y="1082.0039"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="115" y="1081.6802">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="107" y="1097.3145"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="123" y="1096.9907">initiatorId: "pispa",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="107" y="1112.625"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="123" y="1112.3013">scopes: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="107" y="1127.9355"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="139" y="1127.6118">{ accountId: "dfsp.username.1234",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="107" y="1143.2461"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="155" y="1142.9224">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="107" y="1158.5566"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="139" y="1158.2329">{ accountId: "dfsp.username.5678",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="107" y="1173.8672"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="155" y="1173.5435">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="107" y="1189.1777"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="123" y="1188.854">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="107" y="1204.4883"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="123" y="1204.1646">authChannels: [ "Web" ],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="107" y="1219.7988"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="123" y="1219.4751">callbackUri: "pisp-app://callback...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="411" y="1219.7988">"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="107" y="1235.1094"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="123" y="1234.7856"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="536" x="123" y="1234.7856">authUri: "dfspa.com/authorize?consentRequestId=456" // This is new!</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="107" y="1250.4199"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="107" y="1250.0962">}</text><polygon fill="#A80036" points="654,1280.4727,664,1284.4727,654,1288.4727,658,1284.4727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="33" x2="660" y1="1284.4727" y2="1284.4727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="40" y="1279.7305">REQ-8</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="89" y="1279.3179">200 OK</text><path d="M6,1297.4727 L6,1322.4727 L1326,1322.4727 L1326,1307.4727 L1316,1297.4727 L6,1297.4727 " fill="#FBFB77" filter="url(#f1b3sozxs526m4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1316,1297.4727 L1316,1307.4727 L1326,1307.4727 L1316,1297.4727 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="767" x="244" y="1315.041">At this point, the PISP knows that the Web authChannel is in use and the PISP App should redirect the user to the provided</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="1015" y="1314.7173">authUri</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1071" y="1315.041">.</text><!--MD5=[17b4a484a7041fe266b42822a185e6b0]
@startuml

title PISP Linking: Request consent (Web)

participant "PISP" as PISP

box "Mojaloop"
    participant Switch
end box

participant DFSP

autonumber 1 "<b>REQ-#</b>"

activate PISP

...

note over PISP, DFSP
    The user initiated some sort of account linking by choosing the appropriate DFSP from a screen inside the PISP application.
end note

...

PISP -> Switch ++: ""POST /consentRequests""\n  ""  FSIOP-Source: pispa""\n  ""  FSIOP-Destination: dfspa""\n  "" {""\n  ""  id: "456",""\n  ""  initiatorId: "pispa",""\n  ""  scopes: [ ""\n  ""    { **accountId: "dfsp.username.1234", // This is *optional* for web.**""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""    { accountId: "dfsp.username.5678",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""  ],""\n  ""  authChannels: [ "Web", "OTP" ],""\n  ""  callbackUri: "pisp-app://callback..."""\n  ""}""
Switch - -> PISP: ""202 Accepted""
deactivate PISP

Switch -> DFSP ++:  ""POST /consentRequests""\n  ""  FSIOP-Source: pispa""\n  ""  FSIOP-Destination: dfspa""\n  "" {""\n  ""  id: "456",""\n  ""  initiatorId: "pispa",""\n  ""  scopes: [ ""\n  ""    { accountId: "dfsp.username.1234",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""    { accountId: "dfsp.username.5678",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""  ],""\n  ""  authChannels: [ "Web", "OTP" ],""\n  ""  callbackUri: "pisp-app://callback..."""\n  ""}""
DFSP - -> Switch: ""202 Accepted""
deactivate Switch

DFSP -> Switch ++: ""PUT /consentRequests/456""\n  ""  FSIOP-Source: dfspa""\n  ""  FSIOP-Destination: pispa""\n  "" {""\n  ""  initiatorId: "pispa",""\n  ""  scopes: [ ""\n  ""    { accountId: "dfsp.username.1234",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""    { accountId: "dfsp.username.5678",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""  ],""\n  ""  authChannels: [ "Web" ],""\n  ""  callbackUri: "pisp-app://callback..."""\n  ""  **authUri: "dfspa.com/authorize?consentRequestId=456" // This is new!**""\n  ""}""
' TODO: Should this be 200 OK? or 202 Accepted?
Switch - -> DFSP: ""202 Accepted""
deactivate DFSP

Switch -> PISP ++: ""PUT /consentRequests/456""\n  ""  FSIOP-Source: dfspa""\n  ""  FSIOP-Destination: pispa""\n  "" {""\n  ""  initiatorId: "pispa",""\n  ""  scopes: [ ""\n  ""    { accountId: "dfsp.username.1234",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""    { accountId: "dfsp.username.5678",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""  ],""\n  ""  authChannels: [ "Web" ],""\n  ""  callbackUri: "pisp-app://callback..."""\n  ""  **authUri: "dfspa.com/authorize?consentRequestId=456" // This is new!**""\n  ""}""
PISP - -> Switch: ""200 OK""
deactivate Switch

note over PISP, DFSP
  At this point, the PISP knows that the Web authChannel is in use and the PISP App should redirect the user to the provided ""authUri"".
end note

@enduml

@startuml

title PISP Linking: Request consent (Web)

participant "PISP" as PISP

box "Mojaloop"
    participant Switch
end box

participant DFSP

autonumber 1 "<b>REQ-#</b>"

activate PISP

...

note over PISP, DFSP
    The user initiated some sort of account linking by choosing the appropriate DFSP from a screen inside the PISP application.
end note

...

PISP -> Switch ++: ""POST /consentRequests""\n  ""  FSIOP-Source: pispa""\n  ""  FSIOP-Destination: dfspa""\n  "" {""\n  ""  id: "456",""\n  ""  initiatorId: "pispa",""\n  ""  scopes: [ ""\n  ""    { **accountId: "dfsp.username.1234", // This is *optional* for web.**""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""    { accountId: "dfsp.username.5678",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""  ],""\n  ""  authChannels: [ "Web", "OTP" ],""\n  ""  callbackUri: "pisp-app://callback..."""\n  ""}""
Switch - -> PISP: ""202 Accepted""
deactivate PISP

Switch -> DFSP ++:  ""POST /consentRequests""\n  ""  FSIOP-Source: pispa""\n  ""  FSIOP-Destination: dfspa""\n  "" {""\n  ""  id: "456",""\n  ""  initiatorId: "pispa",""\n  ""  scopes: [ ""\n  ""    { accountId: "dfsp.username.1234",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""    { accountId: "dfsp.username.5678",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""  ],""\n  ""  authChannels: [ "Web", "OTP" ],""\n  ""  callbackUri: "pisp-app://callback..."""\n  ""}""
DFSP - -> Switch: ""202 Accepted""
deactivate Switch

DFSP -> Switch ++: ""PUT /consentRequests/456""\n  ""  FSIOP-Source: dfspa""\n  ""  FSIOP-Destination: pispa""\n  "" {""\n  ""  initiatorId: "pispa",""\n  ""  scopes: [ ""\n  ""    { accountId: "dfsp.username.1234",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""    { accountId: "dfsp.username.5678",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""  ],""\n  ""  authChannels: [ "Web" ],""\n  ""  callbackUri: "pisp-app://callback..."""\n  ""  **authUri: "dfspa.com/authorize?consentRequestId=456" // This is new!**""\n  ""}""
Switch - -> DFSP: ""202 Accepted""
deactivate DFSP

Switch -> PISP ++: ""PUT /consentRequests/456""\n  ""  FSIOP-Source: dfspa""\n  ""  FSIOP-Destination: pispa""\n  "" {""\n  ""  initiatorId: "pispa",""\n  ""  scopes: [ ""\n  ""    { accountId: "dfsp.username.1234",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""    { accountId: "dfsp.username.5678",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""  ],""\n  ""  authChannels: [ "Web" ],""\n  ""  callbackUri: "pisp-app://callback..."""\n  ""  **authUri: "dfspa.com/authorize?consentRequestId=456" // This is new!**""\n  ""}""
PISP - -> Switch: ""200 OK""
deactivate Switch

note over PISP, DFSP
  At this point, the PISP knows that the Web authChannel is in use and the PISP App should redirect the user to the provided ""authUri"".
end note

@enduml

PlantUML version 1.2020.18(Thu Oct 01 03:40:44 PHT 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>