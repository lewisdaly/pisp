<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="791px" preserveAspectRatio="none" style="width:1406px;height:791px;" version="1.1" viewBox="0 0 1406 791" width="1406px" zoomAndPan="magnify"><defs><filter height="300%" id="f1im0cwgxm8pcy" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="743.8672" style="stroke: #A80036; stroke-width: 1.0;" width="70" x="624" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="61" x="628.5" y="53.7676">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="239" x="581" y="29.4023">PISP Linking: Grant consent</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="28" x2="28" y1="95.998" y2="743.5781"/><rect fill="#FFFFFF" filter="url(#f1im0cwgxm8pcy)" height="47.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="23" y="696.2676"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="659" x2="659" y1="95.998" y2="743.5781"/><rect fill="#FFFFFF" filter="url(#f1im0cwgxm8pcy)" height="364.1895" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="654" y="369.3887"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1309" x2="1309" y1="95.998" y2="743.5781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1370.5" x2="1370.5" y1="95.998" y2="743.5781"/><rect fill="#FFFFFF" filter="url(#f1im0cwgxm8pcy)" height="47.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1365.5" y="696.2676"/><rect fill="#FEFECE" filter="url(#f1im0cwgxm8pcy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="12" y="81.0449">PISP</text><rect fill="#FEFECE" filter="url(#f1im0cwgxm8pcy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="628" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="635" y="81.0449">Switch</text><rect fill="#FEFECE" filter="url(#f1im0cwgxm8pcy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="48" x="1283" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="34" x="1290" y="81.0449">DFSP</text><rect fill="#FEFECE" filter="url(#f1im0cwgxm8pcy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="47" x="1345" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="33" x="1352" y="81.0449">Auth</text><rect fill="#FEFECE" filter="url(#f1im0cwgxm8pcy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="5" y="743.5781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="12" y="764.1133">PISP</text><rect fill="#FEFECE" filter="url(#f1im0cwgxm8pcy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="628" y="743.5781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="635" y="764.1133">Switch</text><rect fill="#FEFECE" filter="url(#f1im0cwgxm8pcy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="48" x="1283" y="743.5781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="34" x="1290" y="764.1133">DFSP</text><rect fill="#FEFECE" filter="url(#f1im0cwgxm8pcy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="47" x="1345" y="743.5781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="33" x="1352" y="764.1133">Auth</text><polygon fill="#A80036" points="675,365.3887,665,369.3887,675,373.3887,671,369.3887" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="669" x2="1308" y1="369.3887" y2="369.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="65" x="681" y="242.6064">GRANT-1</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="750" y="120.0649">POST /consents</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="766" y="135.1978">FSIOP-Source: dfspa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="766" y="150.3306">FSIOP-Destination: auth.dfspa**</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="766" y="165.4634">FSIOP-Destination: pispa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="766" y="180.5962">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="766" y="196.2305"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="782" y="195.9067">id: "123",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="766" y="211.541"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="782" y="211.2173">requestId: "456",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="766" y="226.8516"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="782" y="226.5278">initiatorId: "pispa",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="766" y="242.1621"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="782" y="241.8384">participantId: "dfspa",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="766" y="257.4727"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="782" y="257.1489">scopes: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="766" y="272.7832"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="798" y="272.4595">{</text><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="488" x="814" y="272.4595">accountId: "dfsp.username.1234", // If web, these may change!</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="766" y="288.0938"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="814" y="287.77">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="766" y="303.4043"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="798" y="303.0806">{ accountId: "dfsp.username.5678",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="766" y="318.7148"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="814" y="318.3911">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="766" y="334.0254"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="782" y="333.7017">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="766" y="349.3359"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="782" y="349.0122">credential: null</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="766" y="364.6465"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="766" y="364.3228">}</text><polygon fill="#A80036" points="1297,394.6992,1307,398.6992,1297,402.6992,1301,398.6992" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="664" x2="1303" y1="398.6992" y2="398.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="65" x="671" y="393.957">GRANT-2</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="740" y="393.5444">202 Accepted</text><path d="M401,411.6992 L401,436.6992 L913,436.6992 L913,421.6992 L903,411.6992 L401,411.6992 " fill="#FBFB77" filter="url(#f1im0cwgxm8pcy)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M903,411.6992 L903,421.6992 L913,421.6992 L903,411.6992 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="491" x="407" y="429.2676">The Switch must inform both the PISP and the Auth service about the consent.</text><polygon fill="#A80036" points="44,692.2676,34,696.2676,44,700.2676,40,696.2676" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="38" x2="653" y1="696.2676" y2="696.2676"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="65" x="50" y="577.0518">GRANT-3</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="119" y="462.0767">POST /consents</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="135" y="477.2095">FSIOP-Source: dfspa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="135" y="492.3423">FSIOP-Destination: pispa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="143" y="507.4751">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="135" y="523.1094"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="151" y="522.7856">id: "123",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="135" y="538.4199"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="151" y="538.0962">requestId: "456",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="135" y="553.7305"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="151" y="553.4067">initiatorId: "pispa",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="135" y="569.041"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="151" y="568.7173">participantId: "dfspa",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="135" y="584.3516"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="151" y="584.0278">scopes: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="135" y="599.6621"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="167" y="599.3384">{ accountId: "dfsp.username.1234",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="135" y="614.9727"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="183" y="614.6489">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="135" y="630.2832"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="167" y="629.9595">{ accountId: "dfsp.username.5678",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="135" y="645.5938"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="183" y="645.27">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="135" y="660.9043"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="151" y="660.5806">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="135" y="676.2148"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="151" y="675.8911">credential: null</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="135" y="691.5254"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="135" y="691.2017">}</text><polygon fill="#A80036" points="1353.5,692.2676,1363.5,696.2676,1353.5,700.2676,1357.5,696.2676" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="664" x2="1359.5" y1="696.2676" y2="696.2676"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="65" x="671" y="577.0518">GRANT-4</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="740" y="462.0767">POST /consents</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="756" y="477.2095">FSIOP-Source: dfspa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="756" y="492.3423">FSIOP-Destination: auth.dfspa**</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="748" y="507.4751">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="756" y="523.1094"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="772" y="522.7856">id: "123",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="756" y="538.4199"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="772" y="538.0962">requestId: "456",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="756" y="553.7305"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="772" y="553.4067">initiatorId: "pispa",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="756" y="569.041"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="772" y="568.7173">participantId: "dfspa",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="756" y="584.3516"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="772" y="584.0278">scopes: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="756" y="599.6621"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="788" y="599.3384">{ accountId: "dfsp.username.1234",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="756" y="614.9727"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="804" y="614.6489">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="756" y="630.2832"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="788" y="629.9595">{ accountId: "dfsp.username.5678",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="756" y="645.5938"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="804" y="645.27">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="756" y="660.9043"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="772" y="660.5806">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="756" y="676.2148"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="772" y="675.8911">credential: null</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="756" y="691.5254"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="756" y="691.2017">}</text><polygon fill="#A80036" points="642,721.5781,652,725.5781,642,729.5781,646,725.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="33" x2="648" y1="725.5781" y2="725.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="65" x="40" y="720.8359">GRANT-5</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="109" y="720.4233">202 Accepted</text><polygon fill="#A80036" points="675,721.5781,665,725.5781,675,729.5781,671,725.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="669" x2="1364.5" y1="725.5781" y2="725.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="65" x="681" y="720.8359">GRANT-6</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="750" y="720.4233">202 Accepted</text><!--MD5=[ce48ba4b3bbea8c418cb9731ec8e4383]
@startuml

!pragma teoz true

title PISP Linking: Grant consent

participant "PISP" as PISP

box "Mojaloop"
    participant Switch
end box

participant "DFSP" as DFSP

autonumber 1 "<b>GRANT-#</b>"

' Let's propose this, but if not
' fall back to 2 different requests
DFSP -> Switch ++: ""POST /consents""\n""  FSIOP-Source: dfspa""\n""  FSIOP-Destination: auth.dfspa**""\n""  FSIOP-Destination: pispa""\n""  {""\n    ""  id: "123",""\n    ""  requestId: "456",""\n    ""  initiatorId: "pispa",""\n    ""  participantId: "dfspa",""\n    ""  scopes: [ ""\n    ""    { **accountId: "dfsp.username.1234", // If web, these may change!**""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""    { accountId: "dfsp.username.5678",""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""  ],""\n    ""  credential: null""\n    ""}""
Switch - -> DFSP: ""202 Accepted""
deactivate DFSP

note over Switch
  The Switch must inform both the PISP and the Auth service about the consent.
end note

Switch -> PISP ++: ""POST /consents""\n""  FSIOP-Source: dfspa""\n""  FSIOP-Destination: pispa""\n""   {""\n    ""  id: "123",""\n    ""  requestId: "456",""\n    ""  initiatorId: "pispa",""\n    ""  participantId: "dfspa",""\n    ""  scopes: [ ""\n    ""    { accountId: "dfsp.username.1234",""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""    { accountId: "dfsp.username.5678",""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""  ],""\n    ""  credential: null""\n    ""}""
& Switch -> Auth ++: ""POST /consents""\n""  FSIOP-Source: dfspa""\n""  FSIOP-Destination: auth.dfspa**""\n"" {""\n    ""  id: "123",""\n    ""  requestId: "456",""\n    ""  initiatorId: "pispa",""\n    ""  participantId: "dfspa",""\n    ""  scopes: [ ""\n    ""    { accountId: "dfsp.username.1234",""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""    { accountId: "dfsp.username.5678",""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""  ],""\n    ""  credential: null""\n    ""}""

PISP - -> Switch: ""202 Accepted""
& Auth - -> Switch: ""202 Accepted""

deactivate Switch

@enduml

@startuml

!pragma teoz true

title PISP Linking: Grant consent

participant "PISP" as PISP

box "Mojaloop"
    participant Switch
end box

participant "DFSP" as DFSP

autonumber 1 "<b>GRANT-#</b>"

DFSP -> Switch ++: ""POST /consents""\n""  FSIOP-Source: dfspa""\n""  FSIOP-Destination: auth.dfspa**""\n""  FSIOP-Destination: pispa""\n""  {""\n    ""  id: "123",""\n    ""  requestId: "456",""\n    ""  initiatorId: "pispa",""\n    ""  participantId: "dfspa",""\n    ""  scopes: [ ""\n    ""    { **accountId: "dfsp.username.1234", // If web, these may change!**""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""    { accountId: "dfsp.username.5678",""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""  ],""\n    ""  credential: null""\n    ""}""
Switch - -> DFSP: ""202 Accepted""
deactivate DFSP

note over Switch
  The Switch must inform both the PISP and the Auth service about the consent.
end note

Switch -> PISP ++: ""POST /consents""\n""  FSIOP-Source: dfspa""\n""  FSIOP-Destination: pispa""\n""   {""\n    ""  id: "123",""\n    ""  requestId: "456",""\n    ""  initiatorId: "pispa",""\n    ""  participantId: "dfspa",""\n    ""  scopes: [ ""\n    ""    { accountId: "dfsp.username.1234",""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""    { accountId: "dfsp.username.5678",""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""  ],""\n    ""  credential: null""\n    ""}""
& Switch -> Auth ++: ""POST /consents""\n""  FSIOP-Source: dfspa""\n""  FSIOP-Destination: auth.dfspa**""\n"" {""\n    ""  id: "123",""\n    ""  requestId: "456",""\n    ""  initiatorId: "pispa",""\n    ""  participantId: "dfspa",""\n    ""  scopes: [ ""\n    ""    { accountId: "dfsp.username.1234",""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""    { accountId: "dfsp.username.5678",""\n    ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n    ""  ],""\n    ""  credential: null""\n    ""}""

PISP - -> Switch: ""202 Accepted""
& Auth - -> Switch: ""202 Accepted""

deactivate Switch

@enduml

PlantUML version 1.2020.18(Thu Oct 01 03:40:44 PHT 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>