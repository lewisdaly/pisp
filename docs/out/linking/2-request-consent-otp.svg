<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1361px" preserveAspectRatio="none" style="width:1341px;height:1361px;" version="1.1" viewBox="0 0 1341 1361" width="1341px" zoomAndPan="magnify"><defs><filter height="300%" id="f6p4lgwvyfkew" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="263" x="539" y="23.5352">PISP Linking: Request consent (OTP)</text><rect fill="#DDDDDD" height="1316.4297" style="stroke: #A80036; stroke-width: 1.0;" width="70" x="634" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="61" x="638.5" y="47.0566">Mojaloop</text><rect fill="#FFFFFF" filter="url(#f6p4lgwvyfkew)" height="67.3105" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="26" y="99.2871"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="26" y1="99.2871" y2="166.5977"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36" x2="36" y1="99.2871" y2="166.5977"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="36" y1="99.2871" y2="99.2871"/><rect fill="#FFFFFF" filter="url(#f6p4lgwvyfkew)" height="249.3027" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="26" y="194.5977"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="26" y1="194.5977" y2="443.9004"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36" x2="36" y1="194.5977" y2="443.9004"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="36" y1="443.9004" y2="443.9004"/><rect fill="#FFFFFF" filter="url(#f6p4lgwvyfkew)" height="77.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="26" y="1225.8086"/><rect fill="#FFFFFF" filter="url(#f6p4lgwvyfkew)" height="286.6133" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="664" y="414.5898"/><rect fill="#FFFFFF" filter="url(#f6p4lgwvyfkew)" height="325.9238" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="664" y="929.1953"/><rect fill="#FFFFFF" filter="url(#f6p4lgwvyfkew)" height="286.6133" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1302" y="671.8926"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="31" x2="31" y1="89.2871" y2="99.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="31" x2="31" y1="99.2871" y2="127.2871"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="31" x2="31" y1="127.2871" y2="166.5977"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="31" x2="31" y1="166.5977" y2="194.5977"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="31" x2="31" y1="194.5977" y2="1312.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="669" x2="669" y1="89.2871" y2="99.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="669" x2="669" y1="99.2871" y2="127.2871"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="669" x2="669" y1="127.2871" y2="166.5977"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="669" x2="669" y1="166.5977" y2="194.5977"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="669" x2="669" y1="194.5977" y2="1312.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307" x2="1307" y1="89.2871" y2="99.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1307" x2="1307" y1="99.2871" y2="127.2871"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307" x2="1307" y1="127.2871" y2="166.5977"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1307" x2="1307" y1="166.5977" y2="194.5977"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307" x2="1307" y1="194.5977" y2="1312.4297"/><rect fill="#FEFECE" filter="url(#f6p4lgwvyfkew)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="8" y="53.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="15" y="74.334">PISP</text><rect fill="#FEFECE" filter="url(#f6p4lgwvyfkew)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="8" y="1311.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="15" y="1331.9648">PISP</text><rect fill="#FEFECE" filter="url(#f6p4lgwvyfkew)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="638" y="53.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="645" y="74.334">Switch</text><rect fill="#FEFECE" filter="url(#f6p4lgwvyfkew)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="638" y="1311.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="645" y="1331.9648">Switch</text><rect fill="#FEFECE" filter="url(#f6p4lgwvyfkew)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="48" x="1281" y="53.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="34" x="1288" y="74.334">DFSP</text><rect fill="#FEFECE" filter="url(#f6p4lgwvyfkew)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="48" x="1281" y="1311.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="34" x="1288" y="1331.9648">DFSP</text><rect fill="#FFFFFF" filter="url(#f6p4lgwvyfkew)" height="67.3105" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="26" y="99.2871"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="26" y1="99.2871" y2="166.5977"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36" x2="36" y1="99.2871" y2="166.5977"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="36" y1="99.2871" y2="99.2871"/><rect fill="#FFFFFF" filter="url(#f6p4lgwvyfkew)" height="249.3027" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="26" y="194.5977"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="26" y1="194.5977" y2="443.9004"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36" x2="36" y1="194.5977" y2="443.9004"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="36" y1="443.9004" y2="443.9004"/><rect fill="#FFFFFF" filter="url(#f6p4lgwvyfkew)" height="77.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="26" y="1225.8086"/><rect fill="#FFFFFF" filter="url(#f6p4lgwvyfkew)" height="286.6133" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="664" y="414.5898"/><rect fill="#FFFFFF" filter="url(#f6p4lgwvyfkew)" height="325.9238" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="664" y="929.1953"/><rect fill="#FFFFFF" filter="url(#f6p4lgwvyfkew)" height="286.6133" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1302" y="671.8926"/><path d="M9,132.2871 L9,157.2871 L1329,157.2871 L1329,142.2871 L1319,132.2871 L9,132.2871 " fill="#FBFB77" filter="url(#f6p4lgwvyfkew)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1319,132.2871 L1319,142.2871 L1329,142.2871 L1319,132.2871 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="775" x="275" y="149.8555">The user initiated some sort of account linking by choosing the appropriate DFSP from a screen inside the PISP application.</text><polygon fill="#A80036" points="652,410.5898,662,414.5898,652,418.5898,656,414.5898" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36" x2="658" y1="414.5898" y2="414.5898"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="43" y="310.5068">REQ-1</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="92" y="210.6646">POST /consentRequests</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="100" y="226.2988"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="116" y="225.9751">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="100" y="241.6094"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="116" y="241.2856">FSIOP-Destination: dfspa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="92" y="256.4185">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="100" y="272.0527"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="116" y="271.729">consentRequestId: "456",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="100" y="287.3633"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="116" y="287.0396">scopes: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="100" y="302.6738"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="132" y="302.3501">{</text><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="424" x="148" y="302.3501">accountId: "dfsp.username.1234", // Required for OTP!</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="100" y="317.9844"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="148" y="317.6606">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="100" y="333.2949"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="132" y="332.9712">{ accountId: "dfsp.username.5678",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="100" y="348.6055"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="148" y="348.2817">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="100" y="363.916"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="116" y="363.5923">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="100" y="379.2266"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="116" y="378.9028">authChannels: [ "Web", "OTP" ],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="100" y="394.5371"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="116" y="394.2134">callbackUri: "pisp-app://callback...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="404" y="394.5371">"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="100" y="409.8477"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="100" y="409.5239">}</text><polygon fill="#A80036" points="42,439.9004,32,443.9004,42,447.9004,38,443.9004" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="36" x2="663" y1="443.9004" y2="443.9004"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="48" y="439.1582">REQ-2</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="97" y="438.7456">202 Accepted</text><polygon fill="#A80036" points="1290,667.8926,1300,671.8926,1290,675.8926,1294,671.8926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="674" x2="1296" y1="671.8926" y2="671.8926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="681" y="567.8096">REQ-3</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="730" y="467.9673">POST /consentRequests</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="738" y="483.6016"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="754" y="483.2778">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="738" y="498.9121"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="754" y="498.5884">FSIOP-Destination: dfspa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="730" y="513.7212">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="738" y="529.3555"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="754" y="529.0317">consentRequestId: "456",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="738" y="544.666"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="754" y="544.3423">scopes: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="738" y="559.9766"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="770" y="559.6528">{</text><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="424" x="786" y="559.6528">accountId: "dfsp.username.1234", // Required for OTP!</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="738" y="575.2871"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="786" y="574.9634">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="738" y="590.5977"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="770" y="590.2739">{ accountId: "dfsp.username.5678",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="738" y="605.9082"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="786" y="605.5845">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="738" y="621.2188"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="754" y="620.895">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="738" y="636.5293"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="754" y="636.2056">authChannels: [ "Web", "OTP" ],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="738" y="651.8398"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="754" y="651.5161">callbackUri: "pisp-app://callback...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1042" y="651.8398">"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="738" y="667.1504"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="738" y="666.8267">}</text><polygon fill="#A80036" points="680,697.2031,670,701.2031,680,705.2031,676,701.2031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="674" x2="1301" y1="701.2031" y2="701.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="686" y="696.4609">REQ-4</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="735" y="696.0483">202 Accepted</text><polygon fill="#A80036" points="685,925.1953,675,929.1953,685,933.1953,681,929.1953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="679" x2="1301" y1="929.1953" y2="929.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="691" y="825.1123">REQ-5</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="740" y="725.27">PUT /consentRequests/456</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="748" y="740.9043"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="764" y="740.5806">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="748" y="756.2148"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="764" y="755.8911">FSIOP-Destination: pispa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="748" y="771.0239">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="748" y="786.6582"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="764" y="786.3345"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="536" x="764" y="786.3345">authChannels: [ "OTP" ], // This is updated with the channel in use</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="748" y="801.9688"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="764" y="801.645">scopes: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="748" y="817.2793"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="780" y="816.9556">{ accountId: "dfsp.username.1234",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="748" y="832.5898"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="796" y="832.2661">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="748" y="847.9004"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="780" y="847.5767">{ accountId: "dfsp.username.5678",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="748" y="863.2109"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="796" y="862.8872">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="748" y="878.5215"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="764" y="878.1978">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="748" y="893.832"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="764" y="893.5083">callbackUri: "pisp-app://callback...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1052" y="893.832">"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="748" y="909.1426"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="764" y="908.8188"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248" x="764" y="908.8188">//note: no authUri for OTP flow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="748" y="924.4531"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="748" y="924.1294">}</text><polygon fill="#A80036" points="1295,954.5059,1305,958.5059,1295,962.5059,1299,958.5059" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="674" x2="1301" y1="958.5059" y2="958.5059"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="681" y="953.7637">REQ-6</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="730" y="953.3511">202 Accepted</text><path d="M9,971.5059 L9,996.5059 L1329,996.5059 L1329,981.5059 L1319,971.5059 L9,971.5059 " fill="#FBFB77" filter="url(#f6p4lgwvyfkew)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1319,971.5059 L1319,981.5059 L1329,981.5059 L1319,971.5059 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="398" x="463.5" y="989.0742">Here, the DFSP sends an OTP directly to the user (e.g., via SMS).</text><polygon fill="#A80036" points="47,1221.8086,37,1225.8086,47,1229.8086,43,1225.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="41" x2="663" y1="1225.8086" y2="1225.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="53" y="1121.7256">REQ-7</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="102" y="1021.8833">PUT /consentRequests/456</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="110" y="1037.5176"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="126" y="1037.1938">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="110" y="1052.8281"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="126" y="1052.5044">FSIOP-Destination: pispa</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="102" y="1067.6372">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="110" y="1083.2715"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="126" y="1082.9478"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="536" x="126" y="1082.9478">authChannels: [ "OTP" ], // This is updated with the channel in use</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="110" y="1098.582"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="126" y="1098.2583">scopes: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="110" y="1113.8926"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="142" y="1113.5688">{ accountId: "dfsp.username.1234",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="110" y="1129.2031"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="158" y="1128.8794">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="110" y="1144.5137"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="142" y="1144.1899">{ accountId: "dfsp.username.5678",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="110" y="1159.8242"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="158" y="1159.5005">actions: [ "accounts.transfer", "accounts.getBalance" ] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="110" y="1175.1348"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="126" y="1174.811">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="110" y="1190.4453"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="126" y="1190.1216">callbackUri: "pisp-app://callback...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="414" y="1190.4453">"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="110" y="1205.7559"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="126" y="1205.4321"/><text fill="#000000" font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248" x="126" y="1205.4321">//note: no authUri for OTP flow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="110" y="1221.0664"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="110" y="1220.7427">}</text><polygon fill="#A80036" points="657,1251.1191,667,1255.1191,657,1259.1191,661,1255.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="36" x2="663" y1="1255.1191" y2="1255.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="43" y="1250.377">REQ-8</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="92" y="1249.9644">202 Accepted</text><path d="M9,1268.1191 L9,1293.1191 L1329,1293.1191 L1329,1278.1191 L1319,1268.1191 L9,1268.1191 " fill="#FBFB77" filter="url(#f6p4lgwvyfkew)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1319,1268.1191 L1319,1278.1191 L1329,1278.1191 L1319,1268.1191 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="789" x="268" y="1285.6875">At this point, the PISP knows that the OTP authChannel is in use and the PISP App should prompt the user to provide the OTP.</text><!--
@startuml

title PISP Linking: Request consent (OTP)

participant "PISP" as PISP

box "Mojaloop"
    participant Switch
end box

participant DFSP

autonumber 1 "<b>REQ-#</b>"

activate PISP

...

note over PISP, DFSP
    The user initiated some sort of account linking by choosing the appropriate DFSP from a screen inside the PISP application.
end note

...

PISP -> Switch ++: ""POST /consentRequests""\n  ""  FSIOP-Source: pispa""\n  ""  FSIOP-Destination: dfspa""\n""{""\n  ""  consentRequestId: "456",""\n  ""  scopes: [ ""\n  ""    { **accountId: "dfsp.username.1234", // Required for OTP!**""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""    { accountId: "dfsp.username.5678",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""  ],""\n  ""  authChannels: [ "Web", "OTP" ],""\n  ""  callbackUri: "pisp-app://callback..."""\n  ""}""
Switch - -> PISP: ""202 Accepted""
deactivate PISP

Switch -> DFSP ++:  ""POST /consentRequests""\n  ""  FSIOP-Source: pispa""\n  ""  FSIOP-Destination: dfspa""\n""{""\n  ""  consentRequestId: "456",""\n  ""  scopes: [ ""\n  ""    { **accountId: "dfsp.username.1234", // Required for OTP!**""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""    { accountId: "dfsp.username.5678",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""  ],""\n  ""  authChannels: [ "Web", "OTP" ],""\n  ""  callbackUri: "pisp-app://callback..."""\n  ""}""
DFSP - -> Switch: ""202 Accepted""
deactivate Switch

DFSP -> Switch ++: ""PUT /consentRequests/456""\n  ""  FSIOP-Source: dfspa""\n  ""  FSIOP-Destination: pispa""\n"" {""\n  ""  **authChannels: [ "OTP" ], // This is updated with the channel in use**""\n  ""  scopes: [ ""\n  ""    { accountId: "dfsp.username.1234",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""    { accountId: "dfsp.username.5678",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""  ],""\n  ""  callbackUri: "pisp-app://callback..."""\n  ""  **//note: no authUri for OTP flow**""\n  ""}""
Switch - -> DFSP: ""202 Accepted""

note over PISP, DFSP
  Here, the DFSP sends an OTP directly to the user (e.g., via SMS).
end note

deactivate DFSP

Switch -> PISP ++: ""PUT /consentRequests/456""\n  ""  FSIOP-Source: dfspa""\n  ""  FSIOP-Destination: pispa""\n""{""\n  ""  **authChannels: [ "OTP" ], // This is updated with the channel in use**""\n  ""  scopes: [ ""\n  ""    { accountId: "dfsp.username.1234",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""    { accountId: "dfsp.username.5678",""\n  ""      actions: [ "accounts.transfer", "accounts.getBalance" ] },""\n  ""  ],""\n  ""  callbackUri: "pisp-app://callback..."""\n  ""  **//note: no authUri for OTP flow**""\n  ""}""
PISP - -> Switch: ""202 Accepted""
deactivate Switch

note over PISP, DFSP
  At this point, the PISP knows that the OTP authChannel is in use and the PISP App should prompt the user to provide the OTP.
end note

@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 PHT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_171-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>